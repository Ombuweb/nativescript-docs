<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Concepts :: NativeScript Documentation</title>
    <link rel="canonical" href="http://localhost:3000/advanced-concepts/advanced-concepts.html">
    <link rel="prev" href="../native-api-access/access-and-use.html">
    <link rel="next" href="#distribution/releasing.adoc">
    <meta name="generator" content="Antora 3.0.2">

  <link id="theme" rel="stylesheet" title="Default" href="../_/css/site.css">
  <link rel="stylesheet" title="Dark" href="../_/css/dark-site.css">

    <script>var uiRootPath = '../_'</script>
    <script src="../_/js/vendor/medium-zoom.js"></script>
    <script type="text/javascript" id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="e4db29b5-cd94-4bcf-87e4-04f4ca564240" data-blockingmode="manual"></script>

<link rel="icon" href="../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="top-logo">
        <a href=".." class="lisk-logo"></a>
        <a href=".." class="docs-logo"></a>
      </div>
      <!--<a class="navbar-item" href="http://localhost:3000">NativeScript Documentation</a>-->
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">APIs</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../xxx/api-ref.html">NativeScript API</a>
<!--
add more items here if needed
-->
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://nativescript.com" target="_blank">NativeScript Plugins</a>
<!--
add more items here if needed
-->
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../index.html">NativeScript Documentation</a>
<!--
  add more items here if needed
-->
          </div>
        </div>
        <button onclick="switch_style('toggle')" id="theme-toggle" class="theme-toggle navbar-item"></button>
      </div>
    </div>
  </nav>
</header><div class="toolbar" role="navigation">
  <button class="nav-toggle"></button>
  <div class="components-versions">
      <div class="page-components">
    <button class="component-menu-toggle" title="Show other documentations">NativeScript Documentation</button>
    <div class="component-menu">
        <a class="component is-current" href="../index.html">NativeScript Documentation</a>
    </div>
  </div>
    <span></span>
      </div>
  <span></span>
  <span></span>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">NativeScript Documentation</a></li>
    <li>Advanced Concepts</li>
    <li><a href="advanced-concepts.html">Advanced Concepts</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/ohmynuts/Documents/GitHub/nativescript-docs//docs/modules/ROOT/pages/advanced-concepts/advanced-concepts.adoc"><img class="pencil">Edit this Page</a></div>
</div>
<div class="body">
<div class="nav-container" data-component="ROOT" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">NativeScript Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item parent" data-depth="0">
<ul class="nav-list">
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basics</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../basics/index.html">Nativescript Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../basics/environment-setup.html">Environment Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../basics/development-workflow.html">Development Workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../basics/understanding-packages.html">Understanding @nativescript</a>
  </li>
  <li class="nav-item parent" data-depth="2">
    <button class="nav-item-toggle"></button>
        <span>
    <a class="nav-link" href="../basics/tutorial/index.html">Tutorials</a>
        </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../basics/tutorial/angular.html">Angular Tutorial</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../basics/tutorial/react.html">React Tutorial</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../basics/tutorial/vue.html">Vue Tutorial</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../basics/tutorial/svelte.html">Svelte Tutorial</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../basics/tutorial/plain.html">Plain Tutorial</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Running and building</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../running-and-building/webpack.html">Webpack</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">UI and Styling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui-and-styling/app-resources.html">Understanding App_Resources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui-and-styling/ui-and-styling.html">UI &amp; Styling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ui-and-styling/interaction.html">Interaction</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Networking</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/http.html">Http</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../networking/connectivity.html">Connectivity</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Scalability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scalability/code-sharing.html">Code Sharing</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Native API Access</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../native-api-access/access-and-use.html">Accessing Native Platform APIs</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Advanced Concepts</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="advanced-concepts.html">Advanced Concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Distribution</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#distribution/releasing.adoc">distribution/releasing.adoc</a>
  </li>
</ul>
  </li>
  <li class="nav-item parent" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/troubleshooting.html">Troubleshooting Common Issues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">NativeScript Documentation</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">NativeScript Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Advanced Concepts</h1>
<div class="sect1">
<h2 id="the-layout-process"><a class="anchor" href="#the-layout-process"></a>The Layout process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Getting views to render with the right dimensions and positions requires a run of the layout process. When rendering, a recursive process runs through every view in the <strong>view hierarchy</strong> in two passes &mdash; a measure pass and a layout pass.</p>
</div>
<div class="paragraph">
<p>During <strong>the measure pass</strong> every view is measured to obtain its desired size. The following properties are considered during the measuring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>width</code>, <code>height</code></p>
</li>
<li>
<p><code>minWidth</code>, <code>minHeight</code></p>
</li>
<li>
<p><code>visibility</code></p>
</li>
<li>
<p><code>marginTop</code>, <code>marginRight</code>, <code>marginBottom</code>, <code>marginLeft</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>During <strong>the layout pass</strong> every view is placed in a specific layout slot. The slot is determined by the result of the measure pass and the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>marginTop</code>, <code>marginRight</code>, <code>marginBottom</code>, <code>marginLeft</code></p>
</li>
<li>
<p><code>horizontalAlignment</code>, <code>verticalAlignment</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The layout process is by nature an resource-intensive process and it&#8217;s performance highly depends on the number views (and complexity).</p>
</div>
<div class="paragraph">
<p>:::tip
Try to keep the view hierarchy as flat as possible by utilizing different <a href="/ui-and-styling#layout-containers">Layout Containers</a> rather than relying on excessive view nesting.</p>
</div>
<div class="paragraph">
<p><strong>For example:</strong> don&#8217;t treat <code>&lt;StackLayout&gt;</code> as a <code>&lt;div&gt;</code> &mdash; instead try to use a <code>&lt;GridLayout&gt;</code> with specific <code>rows</code> and <code>columns</code> to achieve the same result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;StackLayout&gt;
  &lt;StackLayout orientation="horizontal"&gt;
    &lt;SomeItem /&gt;
    &lt;SomeItem /&gt;
  &lt;/StackLayout&gt;
  &lt;StackLayout orientation="horizontal"&gt;
    &lt;!-- ... --&gt;
  &lt;/StackLayout&gt;
&lt;/StackLayout&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;GridLayout rows="auto, auto" columns="auto, auto"&gt;
  &lt;SomeItem row="0" col="0" /&gt;
  &lt;SomeItem row="0" col="1" /&gt;
  &lt;!-- ... row="1" ... --&gt;
&lt;/GridLayout&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>One-offs are fine with the <code>&lt;StackLayout&gt;</code> approach, but building a whole app with the first approach will usually result in poor performance.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>== Custom Application and Activity</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>NativeScript provides a way to create custom <code>android.app.Application</code> and <code>android.app.Activity</code> implementations.</p>
</div>
<div class="sect2">
<h3 id="extending-the-android-application"><a class="anchor" href="#extending-the-android-application"></a>Extending the Android Application</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new TypeScript file in the root of your project folder - name it <code>application.android.ts</code> or <code>application.android.js</code> if you are using plain JS.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>tip Note
Note the *.android suffix - we want this file packaged for Android only.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
</dl>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Copy the following code for TypeScript file:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">// the `JavaProxy` decorator specifies the package and the name for the native *.JAVA file generated.
@NativeClass()
@JavaProxy('org.myApp.Application')
class Application extends android.app.Application {
  public onCreate(): void {
    super.onCreate()

    // At this point modules have already been initialized

    // Enter custom initialization code here
  }

  public attachBaseContext(baseContext: android.content.Context) {
    super.attachBaseContext(baseContext)

    // This code enables MultiDex support for the application (if needed)
    // androidx.multidex.MultiDex.install(this);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the following code for the JavaScript file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const superProto = android.app.Application.prototype

// the first parameter of the `extend` call defines the package and the name for the native *.JAVA file generated.
android.app.Application.extend('org.myApp.Application', {
  onCreate: function () {
    superProto.onCreate.call(this)

    // At this point modules have already been initialized

    // Enter custom initialization code here
  },
  attachBaseContext: function (base) {
    superProto.attachBaseContext.call(this, base)
    // This code enables MultiDex support for the application (if needed compile androidx.multidex:multidex)
    // androidx.multidex.MultiDex.install(this);
  }
})</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the application entry within the AndroidManifest.xml file found in the <code>&lt;application-name&gt;/App_Resources/Android/</code> folder:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;application
        android:name="org.myApp.Application"
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:theme="@style/AppTheme" &gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>tip Note
This modification is required by the native platform; it tells Android that your custom Application class will be used as the main entry point of the application.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In order to build the app, the extended Android application should be added to the webpack.config.js file.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const webpack = require('@nativescript/webpack')

module.exports = env =&gt; {
  webpack.init(env)

  webpack.chainWebpack(config =&gt; {
    if (webpack.Utils.platform.getPlatformName() === 'android') {
      // make sure the path to the applicatioon.android.(js|ts)
      // is relative to the webpack.config.js
      // you may need to use `./app/application.android if
      // your app source is located inside the ./app folder.
      config.entry('application').add('./application.android')
    }
  })

  return webpack.resolveConfig()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The source code of <code>application.android.ts</code> is bundled separately as <code>application.js</code> file which is loaded from the native Application.java class on launch.</p>
</div>
<div class="paragraph">
<p>The <code>bundle.js</code> and <code>vendor.js</code> files are not loaded early enough in the application launch. That&#8217;s why the logic in <code>application.android.ts</code> is needed to be bundled separately in order to be loaded as early as needed in the application lifecycle.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
This approach will not work if application.android.ts requires external modules.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>=== Extending Android Activity</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>NativeScript Core ships with a default <code>androidx.appcompat.app.AppCompatActivity</code> implementation, that bootstraps the NativeScript application, without forcing users to declare their custom Activity in every project. In some cases you may need to implement a custom Android Activity. In this section we&#8217;ll look at how to do that!</p>
</div>
<div class="paragraph">
<p>Create a new <code>activity.android.ts</code> or <code>activity.android.js</code> when using plain JS.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>tip Note
Note the <code>.android.(js|ts)</code> suffix - we only want this file on Android.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>A basic Activity looks as follows:</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ts hljs" data-lang="ts">import {
  Frame,
  Application,
  setActivityCallbacks,
  AndroidActivityCallbacks
} from '@nativescript/core'

@NativeClass()
@JavaProxy('org.myApp.MainActivity')
class Activity extends androidx.appcompat.app.AppCompatActivity {
  public isNativeScriptActivity

  private _callbacks: AndroidActivityCallbacks

  public onCreate(savedInstanceState: android.os.Bundle): void {
    Application.android.init(this.getApplication())
    // Set the isNativeScriptActivity in onCreate (as done in the original NativeScript activity code)
    // The JS constructor might not be called because the activity is created from Android.
    this.isNativeScriptActivity = true
    if (!this._callbacks) {
      setActivityCallbacks(this)
    }

    this._callbacks.onCreate(this, savedInstanceState, this.getIntent(), super.onCreate)
  }

  public onNewIntent(intent: android.content.Intent): void {
    this._callbacks.onNewIntent(this, intent, super.setIntent, super.onNewIntent)
  }

  public onSaveInstanceState(outState: android.os.Bundle): void {
    this._callbacks.onSaveInstanceState(this, outState, super.onSaveInstanceState)
  }

  public onStart(): void {
    this._callbacks.onStart(this, super.onStart)
  }

  public onStop(): void {
    this._callbacks.onStop(this, super.onStop)
  }

  public onDestroy(): void {
    this._callbacks.onDestroy(this, super.onDestroy)
  }

  public onPostResume(): void {
    this._callbacks.onPostResume(this, super.onPostResume)
  }

  public onBackPressed(): void {
    this._callbacks.onBackPressed(this, super.onBackPressed)
  }

  public onRequestPermissionsResult(
    requestCode: number,
    permissions: Array&lt;string&gt;,
    grantResults: Array&lt;number&gt;
  ): void {
    this._callbacks.onRequestPermissionsResult(
      this,
      requestCode,
      permissions,
      grantResults,
      undefined /*TODO: Enable if needed*/
    )
  }

  public onActivityResult(
    requestCode: number,
    resultCode: number,
    data: android.content.Intent
  ): void {
    this._callbacks.onActivityResult(
      this,
      requestCode,
      resultCode,
      data,
      super.onActivityResult
    )
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">import { Frame, Application, setActivityCallbacks } from '@nativescript/core'

const superProto = androidx.appcompat.app.AppCompatActivity.prototype
androidx.appcompat.app.AppCompatActivity.extend('org.myApp.MainActivity', {
  onCreate: function (savedInstanceState) {
    // Used to make sure the App is inited in case onCreate is called before the rest of the framework
    Application.android.init(this.getApplication())

    // Set the isNativeScriptActivity in onCreate (as done in the original NativeScript activity code)
    // The JS constructor might not be called because the activity is created from Android.
    this.isNativeScriptActivity = true
    if (!this._callbacks) {
      setActivityCallbacks(this)
    }
    // Modules will take care of calling super.onCreate, do not call it here
    this._callbacks.onCreate(
      this,
      savedInstanceState,
      this.getIntent(),
      superProto.onCreate
    )

    // Add custom initialization logic here
  },
  onNewIntent: function (intent) {
    this._callbacks.onNewIntent(
      this,
      intent,
      superProto.setIntent,
      superProto.onNewIntent
    )
  },
  onSaveInstanceState: function (outState) {
    this._callbacks.onSaveInstanceState(this, outState, superProto.onSaveInstanceState)
  },
  onStart: function () {
    this._callbacks.onStart(this, superProto.onStart)
  },
  onStop: function () {
    this._callbacks.onStop(this, superProto.onStop)
  },
  onDestroy: function () {
    this._callbacks.onDestroy(this, superProto.onDestroy)
  },
  onPostResume: function () {
    this._callbacks.onPostResume(this, superProto.onPostResume)
  },
  onBackPressed: function () {
    this._callbacks.onBackPressed(this, superProto.onBackPressed)
  },
  onRequestPermissionsResult: function (requestCode, permissions, grantResults) {
    this._callbacks.onRequestPermissionsResult(
      this,
      requestCode,
      permissions,
      grantResults,
      undefined
    )
  },
  onActivityResult: function (requestCode, resultCode, data) {
    this._callbacks.onActivityResult(
      this,
      requestCode,
      resultCode,
      data,
      superProto.onActivityResult
    )
  }
  /* Add any other events you need to capture */
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>:::warning Note
The <code>this._callbacks</code> property is automatically assigned to your extended class by the <code>frame.setActivityCallbacks</code> method. It implements the <a href="https://docs.nativescript.org/core-concepts/application-lifecycle#android-activity-events">AndroidActivityCallbacks interface</a> and allows the core modules to get notified for important Activity events. It is <strong>important</strong> to use these callbacks, as many parts of NativeScript rely on them!
:::</p>
</div>
<div class="paragraph">
<p>Next, modify the activity in <code>App_Resources/Android/src/main/AndroidManifest.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;activity
  android:name="org.myApp.MainActivity"
  android:label="@string/title_activity_kimera"
  android:configChanges="keyboardHidden|orientation|screenSize"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To include the new Activity in the build, it has to be added to the webpack compilation by editing the <code>webpack.config.js</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const webpack = require('@nativescript/webpack')

module.exports = env =&gt; {
  env.appComponents = (env.appComponents || []).concat(['./src/activity.android'])
  webpack.init(env)

  return webpack.resolveConfig()
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-objectivecswift-code"><a class="anchor" href="#adding-objectivecswift-code"></a>Adding ObjectiveC/Swift Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the Objective-C/Swift symbols to be accessible by the Nativescript runtimes the following criteria should be met:</p>
</div>
<div class="paragraph">
<p><strong>1)</strong> They need to be compiled and linked</p>
</div>
<div class="paragraph">
<p><strong>2)</strong> Metadata needs to be generated for them</p>
</div>
<div class="paragraph">
<p>The first task is done by the NativeScript CLI by adding the source files to the generated <em>.xcodeproj</em>. For the second one the Metadata Generator needs to find a <a href="https://clang.llvm.org/docs/Modules.html">module.modulemap</a> of the compiled modules.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
For <em>.swift</em> files <em>module.modulemap</em> is not required.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>In order to satisfy the above constraints the developer has to:</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>1)</strong> Place the source files in <em>App_Resources/iOS/src/</em></p>
</div>
<div class="paragraph">
<p><strong>2)</strong> Create a modulemap for the Objective-C files</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
Swift classes need to be accessible from the Objective-C runtime in order to be used from NativeScript. This can be done by using the <em>@objc</em> attribute or by inheriting <em>NSObject</em>.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>For a detailed walkthrough on how to use native iOS source code in NativeScript <a href="https://blog.nativescript.org/adding-objective-c-code-to-a-nativescript-app/">here</a>.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="objective-c-example"><a class="anchor" href="#objective-c-example"></a>Objective C Example</h3>
<div class="paragraph">
<p>A minimal example for adding native Objective C source code to your NativeScript application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create ExampleCrypto.m file with the following content:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">// import required header files
#import &lt;CommonCrypto/CommonDigest.h&gt;
#import &lt;CommonCrypto/CommonHMAC.h&gt;
#import "ExampleCrypto.h"

@implementation ExampleCrypto

+ (NSString *)generateHMACWithApiKey:(NSString *) apiKey andApiSecret:(NSString *) apiSecret {
    NSString *hmacData = [NSString stringWithFormat:@"%@%@%@%@%@",apiKey];

    // Make sure the HMAC hash is in hex
    unsigned char outputHMAC[CC_SHA256_DIGEST_LENGTH];
    const char* keyChar = [apiSecret cStringUsingEncoding:NSUTF8StringEncoding];
    const char* dataChar = [hmacData cStringUsingEncoding:NSUTF8StringEncoding];
    CCHmac(kCCHmacAlgSHA256, keyChar, strlen(keyChar), dataChar, strlen(dataChar), outputHMAC);
    NSData* hmacHash = [[NSData alloc] initWithBytes:outputHMAC length:sizeof(outputHMAC)];

    NSString* hmacHashHexString = [[hmacHash description] stringByReplacingOccurrencesOfString:@" " withString:@""];

    // Authorization : base64 of hmac hash --&gt;
    NSString* authorization = [[hmacHashHexString dataUsingEncoding:NSUTF8StringEncoding] base64EncodedStringWithOptions:0];

    return authorization;
}

@end</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create ExampleCrypto.h file with the following content:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">#import &lt;Foundation/Foundation.h&gt;

@interface ExampleCrypto : NSObject

+ (NSString *)generateHMACWithApiKey:(NSString *)apiKey andApiSecret:(NSString *)apiSecret;

@end</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the module.modulemap file with the following content:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">module ExampleCrypto {
  header "ExampleCrypto.h"
  export *
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Call the static method from the ObjectiveC source code just added somewhere in your application.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">function generateNativeIOSHMAC() {
  // This if check ensures the following code is only executed on iOS.
  if (global.isIOS) {
    const apiKey = '9292skksd88172alekdd782939ssa'
    const apiSecret = 'f82828282828f992f'

    const base64encryptedKey = ExampleCrypto.generateHMACWithApiKeyandApiSecret(
      apiKey,
      apiSecret
    )
    console.log('base64encryptedKey', base64encryptedKey)
  }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build your NativeScript application by running the following and you should see the base64encryptedKey print in your terminal.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cli hljs" data-lang="cli">ns clean
ns run ios --no-hmr</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="marshalling"><a class="anchor" href="#marshalling"></a>Marshalling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ios-marshalling"><a class="anchor" href="#ios-marshalling"></a>iOS Marshalling</h3>
<div class="paragraph">
<p>NativeScript for iOS handles the conversion between JavaScript and Objective-C data types implicitly. However, the rules that govern this conversion need to take into account the differences between JavaScript and Objective-C. NativeScript tries to translate idioms between languages, but there are quirks and features in both that are hard to reconcile. The following is a thorough but not exhaustive list of rules and exceptions NativeScript abides by when exposing Objective-C APIs in JavaScript.</p>
</div>
<div class="sect3">
<h4 id="objective-c-classes-and-objects"><a class="anchor" href="#objective-c-classes-and-objects"></a>Objective-C Classes and Objects</h4>
<div class="paragraph">
<p>The most common data type in Objective-C by far is the class. Classes can have instance or static methods, and properties which are always instance. NativeScript exposes an Objective-C class and its members as a JavaScript constructor function with an associated prototype according to the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">prototypal inheritance model</a>. This means that each static method on an Objective-C class becomes a function on its JavaScript constructor function, each instance method becomes a function on the JavaScript prototype, and each property becomes a property descriptor on the same prototype. Every JavaScript constructor function created to expose an Objective-C class is arranged in a prototype chain that mirrors the class hierarchy in Objective-C: if <code>NSMutableArray</code> extends <code>NSArray</code>, which in turn extends <code>NSObject</code> in Objective-C, then in JavaScript the prototype of the <code>NSObject</code> constructor function is the prototype of <code>NSArray</code>, which in turn is the prototype of <code>NSMutableArray</code>.</p>
</div>
<div class="paragraph">
<p>To illustrate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">@interface NSArray : NSObject

+ (instancetype)arrayWithArray:(NSArray *)anArray;

- (id)objectAtIndex:(NSUInteger)index;

@property (readonly) NSUInteger count;

@end</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var NSArray = {
  __proto__: NSObject,

  arrayWithArray: function () {
    [native code]
  }
}

NSArray.prototype = {
  __proto__: NSObject.prototype,

  constructor: NSArray,

  objectAtIndex: function () {
    [native code]
  },

  get count() {
    [native code]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instances of Objective-C classes exist in JavaScript as special "wrapper" exotic objects - they keep track of and reference native objects, as well as manage their memory. When a native API returns an Objective-C object, NativeScript constructs such a wrapper for it in case one doesn&#8217;t already exist. Wrappers have a prototype just like regular JavaScript objects. This prototype is the same as the prototype of the JavaScript constructor function that exposes the class the native object is an instance of. In essence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const tableViewController = new UITableViewController() // returns a wrapper around a UITableViewController instance
Object.getPrototypeOf(tableViewController) === UITableViewController.prototype // returns true</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is only one JavaScript wrapper around an Objective-C object, always. This means that Objective-C wrappers maintain JavaScript identity equality:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">tableViewController.tableView === tableViewController.tableView</code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling native APIs that expect Objective-C classes or objects is easy - just pass the JavaScript constructor function for the class, or the wrapper for the object.</p>
</div>
<div class="paragraph">
<p>If an API is declared as accepting a <code>Class</code> in Objective-C, the argument in JavaScript is the constructor function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">NSString *className = NSStringFromClass([NSArray class]);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const className = NSStringFromClass(NSArray)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversely, if an API is declared as accepting an instance of a specific class such as <code>NSDate</code>, the argument is a wrapper around an object inheriting from that class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
NSDate *date = [NSDate date];
NSString *formattedDate = [formatter stringFromDate:date];</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const formatter = new NSDateFormatter()
const date = NSDate.date()
const formattedDate = formatter.stringFromDate(date)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An API expecting the <code>id</code> data type in Objective-C means it will any accept Objective-C class or object in JavaScript.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">NSMutableArray *array = [[NSMutableArray alloc] init];
Class buttonClass = [UIButton class];
UIButton *button = [[buttonClass alloc] init];
[array setObject:buttonClass atIndex:0];
[array setObject:button atIndex:1];</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const array = new NSMutableArray()
const buttonClass = UIButton
const button = new buttonClass()
array.setObjectAtIndex(buttonClass, 0)
array.setObjectAtIndex(button, 1)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="converting-javascript-array-to-cgfloat-array"><a class="anchor" href="#converting-javascript-array-to-cgfloat-array"></a>Converting JavaScript array to CGFloat array</h4>
<div class="paragraph">
<p>In the below-given code sample, you can see, how to convert a JavaScript array to a <code>CGFloat</code> array.
In the tabs, you will find the Objective-C code for a function accepting a <code>CGFloat</code> array as an argument and the JavaScript code for calling this native function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const CGFloatArray = interop.sizeof(interop.types.id) == 4 ? Float32Array : Float64Array
const jsArray = [4.5, 0, 1e-5, -1242e10, -4.5, 34, -34, -1e-6]

FloatArraySample.dumpFloats(CGFloatArray.from(jsArray), jsArray.length)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">@interface FloatArraySample
+ (void)dumpFloats:(CGFloat*) arr withCount:(int)cnt;
@end

@implementation TNSBaseInterface

+ (void)dumpFloats:(CGFloat*) arr withCount:(int)cnt {
    for(int i = 0; i &lt; cnt; i++) {
      NSLog(@"arr[%d] = %f", i, arr[i]);
    }
}
@end</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
Keep in mind that <code>CGFloat</code> is architecture dependent. On 32-bit devices, we need to use <code>Float32Array</code> and <code>Float64Array</code>&#8201;&#8212;&#8201;on 64-bit ones. A straightforward way to verify the device/emulator architecture is to check the pointer size via <code>interop.sizeof(interop.types.id)</code>. The return value for the pointer size will be 4 bytes for 32-bit architectures and 8 bytes - for 64-bit ones. For further info, check out <a href="https://developer.apple.com/documentation/coregraphics/cgfloat">CGFloat&#8217;s documentation</a>.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>==== Primitive Exceptions</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>NativeScript considers instances of <code>NSNull</code>, <code>NSNumber</code>, <code>NSString</code> and <code>NSDate</code> to be "primitives". This means that instances of these classes won&#8217;t be exposed in JavaScript via a wrapper exotic object, instead they will be converted to the equivalent JavaScript data type: <code>NSNull</code> becomes <code>null</code>, <code>NSNumber</code> becomes <code>number</code> or <code>boolean</code>, <code>NSString</code> becomes <code>string</code> and <code>NSDate</code> becomes <code>Date</code>. The exception to this are the methods on those classes declared as returning <code>instancetype</code> - init methods and factory methods. This means that a call to <code>NSString.stringWithString</code> whose return type in Objective-C is <code>instancetype</code> will return a wrapper around an <code>NSString</code> instance, rather than a JavaScript string. This applies for all methods on <code>NSNull</code>, <code>NSNumber</code>, <code>NSString</code> and <code>NSDate</code> returning <code>instancetype</code>.</p>
</div>
<div class="paragraph">
<p>On the other hand, any API that expects a <code>NSNull</code>, <code>NSNumber</code>, <code>NSString</code> or <code>NSDate</code> instance in Objective-C can be called either with a wrapper object or a JavaScript value - <code>null</code>, <code>number</code> or <code>boolean</code>, <code>string</code> or <code>Date</code>, in JavaScript. The conversion is automatically handled by NativeScript.</p>
</div>
<div class="paragraph">
<p>More information on how NativeScript deals with Objective-C classes is available <a href="/advanced-concepts.html#objective-c-classes-and-objects">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="objective-c-protocols"><a class="anchor" href="#objective-c-protocols"></a>Objective-C Protocols</h4>
<div class="paragraph">
<p>Protocols in Objective-C are like interfaces in other languages - they are blueprints of what members a class should contain, a sort of an API contract. Protocols are exposed as empty objects in JavaScript. Protocols are usually only referenced when <a href="#ObjC-Subclassing">subclassing</a> an Objective-C class or when checking whether an object or class conforms to a protocol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">BOOL isCopying = [NSArray conformsToProtocol:@protocol(NSCopying)];</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const isCopying = NSArray.conformsToProtocol(NSCopying)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="objective-c-selectors"><a class="anchor" href="#objective-c-selectors"></a>Objective-C Selectors</h4>
<div class="paragraph">
<p>In Objective-C <code>SEL</code> is a data type that represents the name of a method of an Objective-C class. NativeScript exposes this data type as a JavaScript string. Whenever an API expects a selector value in Objective-C, it&#8217;s JavaScript projection will expect a string with the method name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">NSMutableString *aString = [[NSMutableString alloc] init];
BOOL hasAppend = [aString respondsToSelector:@selector(appendString:)];</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const aString = NSMutableString.alloc().init()
const hasAppend = aString.respondsToSelector('appendString:')</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="objective-c-blocks"><a class="anchor" href="#objective-c-blocks"></a>Objective-C Blocks</h4>
<div class="paragraph">
<p><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html">Objective-C blocks</a> are anonymous functions in Objective-C. They can be closures, just like JavaScript functions, and are often used as callbacks. NativeScript implicitly exposes an Objective-C block as a JavaScript function. Any API that accepts a block in Objective-C accepts a JavaScript function when called in JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">NSURL *url = [NSURL URLWithString:@"http://example.com"];
NSURLRequest *request = [NSURLRequest requestWithURL:url];
[NSURLConnection sendAsynchronousRequest:request queue:nil completionHandler:^(NSURLResponse *response, NSData *data, NSError *connectionError) {
    NSLog(@"request complete");
}];</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const url = NSURL.URLWithString('http://example.com')
const request = NSURLRequest.requestWithURL(url)
NSURLConnection.sendAsynchronousRequestQueueCompletionHandler(
  request,
  null,
  (response, data, connectionError) =&gt; {
    console.log('request complete')
  }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Blocks in Objective-C, especially blocks that are closures, need to be properly retained and released in order to not leak memory. NativeScript does this automatically - a block exposed as a JavaScript function is released as soon as the function is garbage collected. A JavaScript function implicitly converted to a block will not be garbage collected as long the block is not released.</p>
</div>
</div>
<div class="sect3">
<h4 id="corefoundation-objects"><a class="anchor" href="#corefoundation-objects"></a>CoreFoundation Objects</h4>
<div class="paragraph">
<p>iOS contains both an Objective-C standard library (the Foundation framework) and a pure C standard library (Core Foundation). Core Foundation is modeled after Foundation to a great extent and implements a limited object model. Data types such as CFDictionaryRef and CFBundleRef are Core Foundation objects. Core Foundation objects are retained and released just like Objective-C objects, using the CFRetain and CFRelease functions. NativeScript implements automatic memory management for functions that are annotated as returning a retained Core Foundation object. For those that are not annotated, NativeScript returns an Unmanaged type that wraps the Core Foundation instance. This makes you partially responsible for keeping the instance allive. You could either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Call takeRetainedValue() which would return managed reference to the wrapped instance, decrementing the reference count while doing so</p>
</li>
<li>
<p>Call takeUnretainedValue() which would return managed reference to the wrapped instance <em>without</em> decrementing the reference count</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="toll-free-bridging"><a class="anchor" href="#toll-free-bridging"></a>Toll-free Bridging</h4>
<div class="paragraph">
<p>Core Foundation has the concept of <a href="https://developer.apple.com/library/ios/documentation/CoreFoundation/Conceptual/CFDesignConcepts/Articles/tollFreeBridgedTypes.html">Toll-free bridged types</a> - data types which can be used interchangeably with their Objective-C counterparts. When dealing with a toll-free bridged type NativeScript always treats it as its Objective-C counterpart. Core Foundation objects on the <a href="https://developer.apple.com/library/ios/documentation/CoreFoundation/Conceptual/CFDesignConcepts/Articles/tollFreeBridgedTypes.html#//apple_ref/doc/uid/TP40010677-SW4">toll-free bridged types list</a> are exposed as if they were instances of the equivalent Objective-C class. This means that a <code>CFDictionaryRef</code> value in JavaScript has the same methods on its prototype as if it were a <code>NSDictionary</code> object. Unlike regular Core Foundation objects, toll-free bridged types are automatically memory managed by NativeScript, so there is no need to retain or release them using <code>CFRetain</code> and <code>CFRelease</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="null-values"><a class="anchor" href="#null-values"></a>Null Values</h4>
<div class="paragraph">
<p>Objective-C has three null values - <code>NULL</code>, <code>Nil</code> and <code>nil</code>. <code>NULL</code> means a regular C pointer to zero, <code>Nil</code> is a <code>NULL</code> pointer to an Objective-C class, and <code>nil</code> is a <code>NULL</code> pointer to an Objective-C object. They are implicitly converted to <code>null</code> in JavaScript. When calling a native API with a <code>null</code> argument NativeScript converts the JavaScript null value to a C pointer to zero. Some APIs require their arguments to not be pointers to zero - invoking them with null in JavaScript can potentially crash the application without a chance to recover.</p>
</div>
</div>
<div class="sect3">
<h4 id="numeric-types"><a class="anchor" href="#numeric-types"></a>Numeric Types</h4>
<div class="paragraph">
<p>Integer and floating point data types in Objective-C are converted to JavaScript numbers. This includes types such as <code>char</code>, <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>NSInteger</code> and their unsigned variants. However, integer values larger than ±2<sup>53</sup> will lose their precision because the JavaScript number type is limited in size to 53-bit integers.</p>
</div>
</div>
<div class="sect3">
<h4 id="struct-types"><a class="anchor" href="#struct-types"></a>Struct Types</h4>
<div class="paragraph">
<p>NativeScript exposes Objective-C structures as JavaScript objects. The properties on such an object are the same as the fields on the structure it exposes. APIs that expect a struct type in Objective-C can be called with a JavaScript object with the same shape as the structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">CGRect rect = {
  .origin = {
    .x = 0,
    .y = 0
  },
  .size = {
    .width = 100,
    .height = 100
  }
};
UIView *view = [[UIView alloc] initWithFrame:rect];</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const rect = {
  origin: {
    x: 0,
    y: 0
  },
  size: {
    width: 100,
    height: 100
  }
}
const view = UIView.alloc().initWithFrame(rect)</code></pre>
</div>
</div>
<div class="paragraph">
<p>More information on how NativeScript deals with structures is available <a href="#C-Structures">here</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="nserror-marshalling"><a class="anchor" href="#nserror-marshalling"></a><code>NSError **</code> marshalling</h4>

</div>
<div class="sect3">
<h4 id="native-to-javascript"><a class="anchor" href="#native-to-javascript"></a>Native to JavaScript</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">@interface NSFileManager : NSObject
+ (NSFileManager *)defaultManager;
- (NSArray *)contentsOfDirectoryAtPath:(NSString *)path error:(NSError **)error;
@end</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use this method from JavaScript in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const fileManager = NSFileManager.defaultManager
const bundlePath = NSBundle.mainBundle.bundlePath

console.log(fileManager.contentsOfDirectoryAtPathError(bundlePath, null))</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to check the error using out parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const errorRef = new interop.Reference()
fileManager.contentsOfDirectoryAtPathError('/not-existing-path', errorRef)
console.log(errorRef.value) // NSError: "The folder '/not-existing-path' doesn't exist."</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we can skip passing the <strong>last NSError *</strong>* out parameter and a JavaScript error will be thrown if the <code>NSError **</code> is set from native:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">try {
  fileManager.contentsOfDirectoryAtPathError('/not-existing-path')
} catch (e) {
  console.log(e) // NSError: "The folder '/not-existing-path' doesn't exist."
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="javascript-to-native"><a class="anchor" href="#javascript-to-native"></a>JavaScript to Native</h4>
<div class="paragraph">
<p>When overriding a method having <strong>NSError *</strong> out parameter in the end* any thrown JavaScript error will be wrapped and set to the <code>NSError **</code> argument (if given).</p>
</div>
</div>
<div class="sect3">
<h4 id="pointer-types"><a class="anchor" href="#pointer-types"></a>Pointer Types</h4>
<div class="paragraph">
<p>Languages in the C family have the notion of a pointer data type. A pointer is a value that points to another value, or, more accurately, to the location of that value in memory. JavaScript has no notion of pointers, but the pointer data type is used throughout the iOS SDK. To overcome this, NativeScript introduces the <code>Reference</code> object. References are special objects which allow JavaScript to reason about and access pointer values. Consider this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-objc hljs" data-lang="objc">NSFileManager *fileManager = [NSFileManager defaultManager];
BOOL isDirectory;
BOOL exists = [fileManager fileExistsAtPath:@"/var/log" isDirectory:&amp;isDirectory];
if (isDirectory) {
    NSLog(@"The path is actually a directory");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet calls the <code>fileExistsAtPath:isDirectory</code> method of the <code>NSFileManager</code> class. This method accepts a <code>NSString</code> as its first argument and a pointer to a boolean value as its second argument. During its execution the method will use the pointer to update the boolean value. This means it will directly change the value of <code>isDirectory</code>. The same code can be written as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const fileManager = NSFileManager.defaultManager
const isDirectory = new interop.Reference()
const exists = fileManager.fileExistsAtPathIsDirectory('/var/log', isDirectory)
if (isDirectory.value) {
  console.log('The path is actually a directory')
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="android-marshalling"><a class="anchor" href="#android-marshalling"></a>Android Marshalling</h3>
<div class="sect3">
<h4 id="data-conversion"><a class="anchor" href="#data-conversion"></a>Data Conversion</h4>
<div class="paragraph">
<p>Being two different worlds, Java/Kotlin and JavaScript use different data types. For example java.lang.String is not the same as the JavaScript&#8217;s String. The NativeScript Runtime provides implicit type conversion that projects types and values from JavaScript to Java and vice-versa. The Kotlin support in the runtime is similar and data conversion is described in the articles JavaScript to Kotlin and Kotlin to JavaScript There are several corner cases - namely with different method overloads, where an explicit input is required to call the desired method but these cases are not common and a typical application will seldom (if ever) need such explicit conversion.</p>
</div>
</div>
<div class="sect3">
<h4 id="javascript-to-java-conversion"><a class="anchor" href="#javascript-to-java-conversion"></a>JavaScript to Java Conversion</h4>
<div class="paragraph">
<p>The article lists the available types in JavaScript and how they are projected to Java.</p>
</div>
<div class="sect4">
<h5 id="string"><a class="anchor" href="#string"></a>String</h5>
<div class="paragraph">
<p>JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_string.asp">String</a> maps to <a href="http://developer.android.com/reference/java/lang/String.html">java.lang.String</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var context = ...;
var button = new android.widget.Button(context);
var text = "My Button"; // JavaScript string
button.setText(text); // text is converted to java.lang.String</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="boolean"><a class="anchor" href="#boolean"></a>Boolean</h5>
<div class="paragraph">
<p>JavaScript <a href="http://www.w3schools.com/js/js_booleans.asp">Boolean</a> maps to Java primitive <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">boolean</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var context = ...;
var button = new android.widget.Button(context);
var enabled = false; // JavaScript Boolean
button.setEnabled(enabled); // enabled is converted to Java primitive boolean</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="undefined-null"><a class="anchor" href="#undefined-null"></a>Undefined &amp; Null</h5>
<div class="paragraph">
<p>JavaScript <a href="http://www.w3schools.com/jsref/jsref_undefined.asp">Undefined</a> &amp; <a href="https://www.w3schools.com/js/js_type_conversion.asp">Null</a> maps to Java <a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.10.7">null literal</a> (or null pointer).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var context = ...;
var button = new android.widget.Button(context);
button.setOnClickListener(undefined); // the Java call will be made using the null keyword</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="number"><a class="anchor" href="#number"></a>Number</h5>
<div class="paragraph">
<p>Java has several primitive numeric types while JavaScript has the <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a> type only. Additionally, unlike JavaScript, Java is a language that supports <a href="http://en.wikipedia.org/wiki/Function_overloading">Method Overloading</a>, which makes the numeric conversion more complex. Consider the following Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class MyObject extends java.lang.Object {
  public void myMethod(byte value){
  }

  public void myMethod(short value){
  }

  public void myMethod(int value){
  }

  public void myMethod(long value){
  }

  public void myMethod(float value){
  }

  public void myMethod(double value){
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following logic applies when calling <code>myMethod</code> on a <code>myObject</code> instance from JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var myObject = new MyObject()</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Implicit <strong>integer</strong> conversion:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">myObject.myMethod(10) // myMethod(int) will be called.</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
If there is no myMethod(int) implementation, the Runtime will try to choose the best possible overload with least conversion loss. If no such method is found an exception will be raised.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Implicit <strong>floating-point</strong> conversion:</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">myObject.myMethod(10.5) // myMethod(double) will be called.</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
If there is no myMethod(double) implementation, the Runtime will try to choose the best possible overload with least conversion loss. If no such method is found an exception will be raised.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Explicitly call an overload:<br>
To enable developers call a specific method overload, the Runtime exposes the following functions directly in the global context:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>   * byte(number) → Java primitive byte

   &gt; The number value will be truncated and only its first byte of the whole part will be used.

   * short(number) → Java primitive short

   &gt; The number value will be truncated and only its first 2 bytes of the whole part will be used.

   * float(number) → Java primitive float

   &gt; The number value will be converted (with a possible precision loss) to a 2^32 floating-point value.

   * long(number) → Java primitive long (in case the number literal fits JavaScript 2^53 limit)

   &gt; The number value's whole part will be taken only.

   * long("number") → Java primitive long (in case the number literal doesn't fit JavaScript 2^53 limit)</pre>
</div>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">myObject.myMethod(byte(10)) // will call myMethod(byte)
myObject.myMethod(short(10)) // will call myMethod(short)
myObject.myMethod(float(10)) // will call myMethod(float)
myObject.myMethod(long(10)) // will call myMethod(long)
myObject.myMethod(long('123456')) // will convert "123456" to Java long and will call myMethod(long)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
When an explicit cast function is called and there is no such implementation found, the Runtime will directly fail, without trying to find a matching overload.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>===== Array</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_array.asp">Array</a> is implicitly converted to a <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/arrays.html">Java Array</a>, using the above described rules for type conversion of the array&#8217;s elements. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class MyObject extends java.lang.Object {
  public void myMethod(java.lang.String[] items){
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var items = ['One', 'Two', 'Three']
var myObject = new MyObject()
myObject.myMethod(items) // will convert to Java array of java.lang.String objects</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="javascript-to-kotlin-conversion"><a class="anchor" href="#javascript-to-kotlin-conversion"></a>Javascript to Kotlin Conversion</h4>
<div class="paragraph">
<p>The article lists the available types in JavaScript and how they are projected to Kotlin.</p>
</div>
<div class="sect4">
<h5 id="string-2"><a class="anchor" href="#string-2"></a>String</h5>
<div class="paragraph">
<p>JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_string.asp">String</a> maps to <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html">kotlin.String</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithStringProperty()
var text = 'My Button' // JavaScript string
kotlinClass.setStringProperty(text) // text is converted to kotlin.String</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="boolean-2"><a class="anchor" href="#boolean-2"></a>Boolean</h5>
<div class="paragraph">
<p>JavaScript <a href="http://www.w3schools.com/js/js_booleans.asp">Boolean</a> maps to Kotlin class <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html">Boolean</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithBooleanProperty()
var enabled = false // JavaScript Boolean
kotlinClass.setBooleanProperty(enabled) // enabled is converted to Kotlin Boolean</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="undefined-null-2"><a class="anchor" href="#undefined-null-2"></a>Undefined &amp; Null</h5>
<div class="paragraph">
<p>JavaScript <a href="http://www.w3schools.com/jsref/jsref_undefined.asp">Undefined</a> &amp; <a href="https://www.w3schools.com/js/js_type_conversion.asp">Null</a> maps to Kotlin null literal (or null pointer).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithNullableParameter(undefined) // the Kotlin call will be made using the null keyword</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="number-2"><a class="anchor" href="#number-2"></a>Number</h5>
<div class="paragraph">
<p>Kotlin has several numeric types while JavaScript has the <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a> type only. Additionally, unlike JavaScript, Kotlin is a language that supports <a href="http://en.wikipedia.org/wiki/Function_overloading">Method Overloading</a>, which makes the numeric conversion more complex. Consider the following Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class MyObject : Any() {
  fun myMethod(value: Byte) {}

  fun myMethod(value: Short) {}

  fun myMethod(value: Int) {}

  fun myMethod(value: Long) {}

  fun myMethod(value: Float) {}

  fun myMethod(value: Double) {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following logic applies when calling <code>myMethod</code> on a <code>myObject</code> instance from JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var myObject = new MyObject()</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Implicit <strong>integer</strong> conversion:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">myObject.myMethod(10) // myMethod(Int) will be called.</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
If there is no myMethod(Int) implementation, the Runtime will try to choose the best possible overload with least conversion loss. If no such method is found an exception will be raised.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Implicit <strong>floating-point</strong> conversion:</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">myObject.myMethod(10.5) // myMethod(Double) will be called.</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
If there is no myMethod(Double) implementation, the Runtime will try to choose the best possible overload with least conversion loss. If no such method is found an exception will be raised.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Explicitly call an overload:<br>
To enable developers call a specific method overload, the Runtime exposes the following functions directly in the global context:</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>   * byte(number) → Kotlin Byte

   &gt;The number value will be truncated and only its first byte of the whole part will be used.

   * short(number) → Kotlin Short

   &gt;The number value will be truncated and only its first 2 bytes of the whole part will be used.

   * float(number) → Kotlin Float

   &gt;The number value will be converted (with a possible precision loss) to a 2^32 floating-point value.

   * long(number) → Kotlin Long (in case the number literal fits JavaScript 2^53 limit)

   &gt;The number value's whole part will be taken only.

   * long("number") → Kotlin Long (in case the number literal doesn't fit JavaScript 2^53 limit)</pre>
</div>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">myObject.myMethod(byte(10)) // will call myMethod(Byte)
myObject.myMethod(short(10)) // will call myMethod(Short)
myObject.myMethod(float(10)) // will call myMethod(Float)
myObject.myMethod(long(10)) // will call myMethod(Long)
myObject.myMethod(long('123456')) // will convert "123456" to Kotlin Long and will call myMethod(Long)</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
When an explicit cast function is called and there is no such implementation found, the Runtime will directly fail, without trying to find a matching overload.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>===== Array</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_array.asp">Array</a> is implicitly converted to a <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-array/index.html">Kotlin Array</a>, using the above described rules for type conversion of the array&#8217;s elements. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class MyObject : Any() {
    fun myMethod(items: Array&lt;String&gt;) {}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var items = ['One', 'Two', 'Three']
var myObject = new MyObject()
myObject.myMethod(items) // will convert to Java array of java.lang.String objects</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-to-javascript-conversion"><a class="anchor" href="#java-to-javascript-conversion"></a>Java to Javascript Conversion</h4>
<div class="paragraph">
<p>The article lists the available types in Java and how they are projected to JavaScript.</p>
</div>
<div class="sect4">
<h5 id="string-character"><a class="anchor" href="#string-character"></a>String &amp; Character</h5>
<div class="paragraph">
<p>Both <a href="http://developer.android.com/reference/java/lang/String.html">java.lang.String</a> and <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Character.html">java.lang.Character</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_string.asp">String</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var file = new java.io.File('/path/to/file')
var path = file.getPath() // returns java.lang.String, converted to JS String</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="boolean-primitive-boolean"><a class="anchor" href="#boolean-primitive-boolean"></a>Boolean &amp; Primitive boolean</h5>
<div class="paragraph">
<p>Both the primitive <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">boolean</a> and reference <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Boolean.html">java.lang.Boolean</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_boolean.asp">Boolean</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var context = ...
var button = new android.widget.Button(context);
var enabled = button.isEnabled(); // returns primitive boolean, converted to JS Boolean</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="byte-primitive-byte"><a class="anchor" href="#byte-primitive-byte"></a>Byte &amp; Primitive byte</h5>
<div class="paragraph">
<p>Both the primitive <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">byte</a> and reference <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Byte.html">java.lang.Byte</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var byte = new java.lang.Byte('1')
var jsByteValue = byte.byteValue() // returns primitive byte, converted to Number</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="short-primitive-short"><a class="anchor" href="#short-primitive-short"></a>Short &amp; Primitive short</h5>
<div class="paragraph">
<p>Both the primitive <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">short</a> and reference <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Short.html">java.lang.Short</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var short = new java.lang.Short('1')
var jsShortValue = short.shortValue() // returns primitive short, converted to Number</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="integer-primitive-int"><a class="anchor" href="#integer-primitive-int"></a>Integer &amp; Primitive int</h5>
<div class="paragraph">
<p>Both the primitive <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">int</a> and reference <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Integer.html">java.lang.Integer</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var int = new java.lang.Integer('1')
var jsIntValue = int.intValue() // returns primitive int, converted to Number</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="float-primitive-float"><a class="anchor" href="#float-primitive-float"></a>Float &amp; Primitive float</h5>
<div class="paragraph">
<p>Both the primitive <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">float</a> and reference <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Float.html">java.lang.Float</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var float = new java.lang.Float('1.5')
var jsFloatValue = float.floatValue() // returns primitive float, converted to Number</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="double-primitive-double"><a class="anchor" href="#double-primitive-double"></a>Double &amp; Primitive double</h5>
<div class="paragraph">
<p>Both the primitive <a href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">double</a> and reference <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Double.html">java.lang.Double</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var double = new java.lang.Double('1.5')
var jsDoubleValue = double.doubleValue() // returns primitive double, converted to Number</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="long-primitive-long"><a class="anchor" href="#long-primitive-long"></a>Long &amp; Primitive long</h5>
<div class="paragraph">
<p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Long.html">java.lang.Long</a> and its primitive equivalent are special types which are projected to JavaScript by applying the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the value is in the interval (-2^53, 2^53) then it is converted to <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a></p>
</li>
<li>
<p>Else a special object with the following characteristics is created:</p>
<div class="ulist">
<ul>
<li>
<p>Has Number.NaN set as a prototype</p>
</li>
<li>
<p>Has value property set to the string representation of the Java long value</p>
</li>
<li>
<p>Its valueOf() method returns NaN</p>
</li>
<li>
<p>Its toString() method returns the string representation of the Java long value</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class TestClass {
	public long getLongNumber54Bits(){
		return 1 &lt;&lt; 54;
	}
	public long getLongNumber53Bits(){
		return 1 &lt;&lt; 53;
	}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var testClass = new TestClass()
var jsNumber = testClass.getLongNumber53Bits() // result is JavaScript Number
var specialObject = testClass.getLongNumber54Bits() // result is the special object described above</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="array"><a class="anchor" href="#array"></a>Array</h5>
<div class="paragraph">
<p>Array in Java is a special <a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html">java.lang.Object</a> that have an implicit Class associated. A Java Array is projected to JavaScript as a special JavaScript proxy object with the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Has length property</p>
</li>
<li>
<p>Has registered indexed getter and setter callbacks, which:</p>
<div class="ulist">
<ul>
<li>
<p>If the array contains elements of type convertible to a JavaScript type, then accessing the i-th element will return a converted type</p>
</li>
<li>
<p>If the array contains elements of type non-convertible to JavaScript, then accessing the i-th element will return a proxy object over the Java/Android type (see <a href="#accessing-apis">Accessing APIs</a>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var directory = new java.io.File('path/to/myDir')
var files = directory.listFiles() // files is a special object as described above
var singleFile = files[0] // the indexed getter callback is triggered and a proxy object over the java.io.File is returned</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
A Java Array is intentionally not converted to a JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_array.asp">Array</a> for the sake of performance, especially when it comes to large arrays.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>===== Array of Objects</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Occasionally you have to create Java arrays from JavaScript. For this scenario we added method <code>create</code> to built-in JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"><code>Array</code> object</a>. Here are some examples how to use <code>Array.create</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">// the following statement is equivalent to byte[] byteArr = new byte[10];
var byteArr = Array.create('byte', 10)

// the following statement is equivalent to String[] stringArr = new String[10];
var stringArr = Array.create(java.lang.String, 10)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the full specification for <code>Array.create</code> method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">Array.create(elementClassName, length)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">Array.create(javaClassCtorFunction, length)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first signature accepts <code>string</code> for <code>elementClassName</code>. This option is useful when you have to create Java array of primitive types (e.g. <code>char</code>, <code>boolean</code>, <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>float</code> and <code>double</code>). It is also useful when you have to create Java jagged arrays. For this scenario <code>elementClassName</code> must be the standard JNI class notation. Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">// equivalent to int[][] jaggedIntArray2 = new int[10][];
var jaggedIntArray2 = Array.create('[I', 10)

// equivalent to boolean[][][] jaggedBooleanArray3 = new boolean[10][][];
var jaggedBooleanArray3 = Array.create('[[Z', 10)

// equivalent to Object[][][][] jaggedObjectArray4 = new Object[10][][][];
var jaggedObjectArray4 = Array.create('[[[Ljava.lang.Object;', 10)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second signature uses <code>javaClassCtorFunction</code> which must the JavaScript constructor function for a given Java type. Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">// equivalent to String[] stringArr = new String[10];
var stringArr = Array.create(java.lang.String, 10)

// equivalent to Object[] objectArr = new Object[10];
var objectArr = Array.create(java.lang.Object, 10)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="array-of-primitive-types"><a class="anchor" href="#array-of-primitive-types"></a>Array of Primitive Types</h4>
<div class="paragraph">
<p>The automatic marshalling works only for cases with arrays of objects. In cases where you have a method that takes an array of primitive types, you need to convert it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static void myMethod(int[] someParam)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then yoy need to invoke it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">let arr = Array.create('int', 3)
arr[0] = 1
arr[1] = 2
arr[2] = 3

SomeObject.myMethod(arr) // assuming the method is accepting an array of primitive types</code></pre>
</div>
</div>
<div class="paragraph">
<p>However there are some other helpful classes we can use to create a few other arrays of primitive types</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const byteArray = java.nio.ByteBuffer.wrap([1]).array()
const shortArray = java.nio.ShortBuffer.wrap([1]).array()
const intArray = java.nio.IntBuffer.wrap([1]).array()
const longArray = java.nio.LongBuffer.wrap([1]).array()
const floatArray = java.nio.FloatBuffer.wrap([1]).array()
const doubleArray = java.nio.DoubleBuffer.wrap([1]).array()</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="two-dimensional-arrays-of-primitive-types"><a class="anchor" href="#two-dimensional-arrays-of-primitive-types"></a>Two-Dimensional Arrays of Primitive Types</h5>
<div class="paragraph">
<p>The above scenario gets more tricky with two-dimensional arrays. Consider a Java method that accepts as an argument a two-dimensional array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public static void myMethod(java.lang.Integer[][] someParam)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The marshalled JavaScript code will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">let arr = Array.create('[Ljava.lang.Integer;', 2)
let elements = Array.create('java.lang.Integer', 3)
elements[0] = new java.lang.Integer(1)
elements[1] = new java.lang.Integer(2)
elements[2] = new java.lang.Integer(3)
arr[0] = elements

SomeObject.myMethod(arr) // assuming the method is accepting a two-dimensional array of primitive types</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="null"><a class="anchor" href="#null"></a>Null</h5>
<div class="paragraph">
<p>The Java <a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-3.html#jls-3.10.7">null literal</a> (or null pointer) is projected to JavaScript <a href="https://www.w3schools.com/js/js_type_conversion.asp">Null</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var context = ...
var button = new android.widget.Button(context);
var background = button.getBackground(); // if there is no background drawable method will return JS null</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="android-types"><a class="anchor" href="#android-types"></a>Android Types</h5>
<div class="paragraph">
<p>All Android-declared types are projected to JavaScript using the Package and Class proxies as described in <a href="#accessing-apis">Accessing APIs</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="kotlin-to-javascript-conversion"><a class="anchor" href="#kotlin-to-javascript-conversion"></a>Kotlin to Javascript Conversion</h4>
<div class="paragraph">
<p>The article lists the available types in Kotlin and how they are projected to JavaScript.</p>
</div>
<div class="paragraph">
<p>Keep in mind that some of Kotlin&#8217;s fundamental types are translated to a Java type by the Kotlin compiler when targeting Android or the JVM. Those types are the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Kotlin non-nullable type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Java type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Kotlin nullable type</strong></th>
<th class="tableblock halign-left valign-top"><strong>Java type</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Any?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.String?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Char?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Boolean?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Byte?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Byte</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Short?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Short</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Int?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Long?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kotlin.Float?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Float</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Although the conversion of Kotlin types in NativeScript is quite the same as the <a href="#java-to-javascript-conversion">Java conversion</a>, let&#8217;s take a look at some examples.</p>
</div>
<div class="sect4">
<h5 id="string-character-2"><a class="anchor" href="#string-character-2"></a>String &amp; Character</h5>
<div class="paragraph">
<p>Both <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html">kotlin.String</a> and <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-char/index.html">kotlin.Char</a> types are projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_string.asp">String</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithStringAndCharProperty()
var str1 = kotlinClass.getStringProperty() // returns kotlin.String, converted to JS String
var str2 = kotlinClass.getCharProperty() // returns kotlin.Char, converted to JS String</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithStringAndCharProperty {
  val stringProperty: String = "string property"
  val charProperty: Char = 'c'
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="boolean-3"><a class="anchor" href="#boolean-3"></a>Boolean</h5>
<div class="paragraph">
<p>Kotlin&#8217;s boolean type <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html">kotlin.Boolean</a> is projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_boolean.asp">Boolean</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithBooleanProperty()
var enabled = kotlinClass.getBooleanProperty() // returns Kotlin Boolean, converted to JS Boolean</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithBooleanProperty {
  val booleanProperty: Boolean = false
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="byte"><a class="anchor" href="#byte"></a>Byte</h5>
<div class="paragraph">
<p>Kotlin&#8217;s byte type <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-byte/index.html">kotlin.Byte</a> is projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithByteProperty()
var jsByteValue = kotlinClass.getByteProperty() // returns Kotlin Byte, converted to Number</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithByteProperty {
  val byteProperty: Byte = 42
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="short"><a class="anchor" href="#short"></a>Short</h5>
<div class="paragraph">
<p>Kotlin&#8217;s short type <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-short/index.html">kotlin.Short</a> is projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithShortProperty()
var jsShortValue = kotlinClass.getShortProperty() // returns Kotlin Short, converted to Number</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithShortProperty {
  val shortProperty: Short = 42
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="integer"><a class="anchor" href="#integer"></a>Integer</h5>
<div class="paragraph">
<p>Kotlin&#8217;s integer type <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html">kotlin.Int</a> is projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithIntProperty()
var jsIntValue = kotlinClass.getIntProperty() // returns Kotlin Int, converted to Number</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithIntProperty {
  val intProperty: Int = 42
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="float"><a class="anchor" href="#float"></a>Float</h5>
<div class="paragraph">
<p>Kotlin&#8217;s float type <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-float/index.html">kotlin.Float</a> is projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithFloatProperty()
var jsFloatValue = kotlinClass.getFloatProperty() // returns Kotlin Float, converted to Number</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithFloatProperty {
  val floatProperty: Float = 42.0f
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="double"><a class="anchor" href="#double"></a>Double</h5>
<div class="paragraph">
<p>Kotlin&#8217;s double type <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-double/index.html">kotlin.Double</a> is projected as JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithDoubleProperty()
var jsDoubleValue = kotlinClass.getDoubleProperty() // returns Kotlin double, converted to Number</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithDoubleProperty {
  val doubleProperty: Double = 42.0
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="long"><a class="anchor" href="#long"></a>Long</h5>
<div class="paragraph">
<p>Kotlin&#8217;s long type <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-long/index.html">kotlin.Long</a> is a special type which is projected to JavaScript by applying the following rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the value is in the interval (-2^53, 2^53) then it is converted to <a href="http://www.w3schools.com/jsref/jsref_obj_number.asp">Number</a></p>
</li>
<li>
<p>Else a special object with the following characteristics is created:</p>
<div class="ulist">
<ul>
<li>
<p>Has Number.NaN set as a prototype</p>
</li>
<li>
<p>Has value property set to the string representation of the Kotlin long value</p>
</li>
<li>
<p>Its valueOf() method returns NaN</p>
</li>
<li>
<p>Its toString() method returns the string representation of the Kotlin long value</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithLongProperties {
  val longNumber54Bits: Long
    get() = (1 shl 54).toLong()
  val longNumber53Bits: Long
    get() = (1 shl 53).toLong()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithLongProperties()
var jsNumber = kotlinClass.getLongNumber53Bits() // result is JavaScript Number
var specialObject = kotlinClass.getLongNumber54Bits() // result is the special object described above</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="array-2"><a class="anchor" href="#array-2"></a>Array</h5>
<div class="paragraph">
<p>Array in Kotlin is a special object that has an implicit Class associated. A Kotlin Array is projected to JavaScript as a special JavaScript proxy object with the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Has length property</p>
</li>
<li>
<p>Has registered indexed getter and setter callbacks, which:</p>
<div class="ulist">
<ul>
<li>
<p>If the array contains elements of type convertible to a JavaScript type, then accessing the n-th element will return a converted type</p>
</li>
<li>
<p>If the array contains elements of type non-convertible to JavaScript, then accessing the n-th element will return a proxy object over the Kotlin type (see <a href="#accessing-apis">Accessing APIs</a>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithStringArrayProperty()
var kotlinArray = kotlinClass.getStringArrayProperty() // kotlinArray is a special object as described above
var firstStringElement = kotlinArray[0] // the indexed getter callback is triggered and the kotlin.String is returned as a JS string</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithStringArrayProperty {
  val stringArrayProperty: Array&lt;String&gt; = arrayOf("element1", "element2", "element3")
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
A Kotlin Array is intentionally not converted to a JavaScript <a href="http://www.w3schools.com/jsref/jsref_obj_array.asp">Array</a> for the sake of performance, especially when it comes to large arrays.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>===== Creating arrays</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Occasionally you have to create Kotlin arrays from JavaScript. Because of the translation of the fundamental Kotlin types to Java types in Android, creating Kotlin array could be done the same way Java arrays are created. This is described in <a href="#java-to-javascript-conversion">Java to JavaScript</a></p>
</div>
</div>
<div class="sect4">
<h5 id="null-2"><a class="anchor" href="#null-2"></a>Null</h5>
<div class="paragraph">
<p>The Kotlin null literal (or null pointer) is projected to JavaScript <a href="https://www.w3schools.com/js/js_type_conversion.asp">Null</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithNullableProperty()
var nullableValue = kotlinClass.getNullableProperty() // if there is no value, the method will return JS null</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithNullableProperty() {
  val nullableProperty: Any? = null
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="kotlin-types"><a class="anchor" href="#kotlin-types"></a>Kotlin Types</h5>
<div class="paragraph">
<p>All Kotlin types are projected to JavaScript using the Package and Class proxies as described in <a href="#accessing-apis">Accessing APIs</a></p>
</div>
</div>
<div class="sect4">
<h5 id="kotlin-companion-objects"><a class="anchor" href="#kotlin-companion-objects"></a>Kotlin Companion objects</h5>
<div class="paragraph">
<p>Kotlin&#8217;s <a href="https://kotlinlang.org/docs/tutorials/kotlin-for-py/objects-and-companion-objects.html#companion-objects">companion objects</a> could be accessed in JavaScript the same way they can be accessed in Java - by accessing the <code>Companion</code> field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var companion = com.example.KotlinClassWithCompanion.Companion
var data = companion.getDataFromCompanion()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithCompanion {
  companion object {
    fun getDataFromCompanion() = "some data"
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="kotlin-object"><a class="anchor" href="#kotlin-object"></a>Kotlin Object</h5>
<div class="paragraph">
<p>Kotlin&#8217;s <a href="https://kotlinlang.org/docs/tutorials/kotlin-for-py/objects-and-companion-objects.html#object-declarations">objects</a> could be accessed in JavaScript the same way they can be accessed in Java - by accessing the INSTANCE field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var objectInstance = com.example.KotlinObject.INSTANCE
var data = objectInstance.getDataFromObject()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

object KotlinObject {
  fun getDataFromObject() = "some data"
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="accessing-kotlin-properties"><a class="anchor" href="#accessing-kotlin-properties"></a>Accessing Kotlin properties</h5>
<div class="paragraph">
<p>Kotlin&#8217;s <a href="https://kotlinlang.org/docs/reference/properties.html#properties-and-fields">properties</a> could be accessed in JavaScript the same way they can be accessed in Java - by using their compiler-generated get/set methods. Non-boolean Kotlin properties could be used in NativeScript applications as JS fields as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var kotlinClass = new com.example.KotlinClassWithStringProperty()

var propertyValue = kotlinClass.getStringPropert()
kotlinClass.setStringProperty('example')

propertyValue = kotlinClass.stringProperty
kotlinClass.stringProperty = 'second example'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

class KotlinClassWithStringProperty(var stringProperty: kotlin.String)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="accessing-kotlin-package-level-functions"><a class="anchor" href="#accessing-kotlin-package-level-functions"></a>Accessing Kotlin package-level functions</h5>
<div class="paragraph">
<p>Currently using Kotlin <a href="https://kotlinlang.org/docs/reference/java-to-kotlin-interop.html#package-level-functions">package-level functions</a> could not be achieved easily. In order to use a package-level function, the class where it&#8217;s defined should be known. Let&#8217;s take a look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var randomNumber = com.example.FunctionsKt.getRandomNumber()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

fun getRandomNumber() = 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the class <code>FunctionsKt</code> is autogenerated by the Kotlin compiler and its name is based on the name of the file where the functions are defined. Kotlin supports annotating a file to have a user provided name and this simplifies using package-level functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var randomNumber = com.example.UtilityFunctions.getRandomNumber()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@file:JvmName("UtilityFunctions")
package com.example

fun getRandomNumber() = 42</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="accessing-kotlin-extension-functions"><a class="anchor" href="#accessing-kotlin-extension-functions"></a>Accessing Kotlin extension functions</h5>
<div class="paragraph">
<p>Currently using Kotlin extension functions could not be achieved easily. In order to use an extension function, the class where it&#8217;s defined should be known. Also, when invoking it, the first parameter should be an instance of the type for which the function is defined. Let&#8217;s take a look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var arrayList = new java.util.ArrayList()
arrayList.add('firstElement')
arrayList.add('secondElement')
com.example.Extensions.switchPlaces(arrayList, 0, 1)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package com.example

import java.util.ArrayList

fun ArrayList&lt;String&gt;.switchPlaces(firstElementIndex: Int, secondElementIndex: Int) {
  val temp = this[firstElementIndex]
  this[firstElementIndex] = this[secondElementIndex]
  this[secondElementIndex] = temp
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the class <code>ExtensionsKt</code> is autogenerated by the Kotlin compiler and its name is based on the name of the file where the functions are defined. Kotlin supports annotating a file to have a user provided name and this simplifies using package-level functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">var arrayList = new java.util.ArrayList()
arrayList.add('firstElement')
arrayList.add('secondElement')
com.example.ExtensionFunctions.switchPlaces(arrayList, 0, 1)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@file:JvmName("ExtensionFunctions")
package com.example

import java.util.ArrayList

fun ArrayList&lt;String&gt;.switchPlaces(firstElementIndex: Int, secondElementIndex: Int) {
  val temp = this[firstElementIndex]
  this[firstElementIndex] = this[secondElementIndex]
  this[secondElementIndex] = temp
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multithreading-workers"><a class="anchor" href="#multithreading-workers"></a>Multithreading &amp; Workers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="multithreading-model"><a class="anchor" href="#multithreading-model"></a>Multithreading Model</h3>
<div class="paragraph">
<p>One of NativeScript&#8217;s benefits is that it allows fast and efficient access to all native platform (Android/Objective-C) APIs through JavaScript, without using (de)serialization or reflection. This however comes with a tradeoff - all JavaScript executes on the main thread (AKA the <code>UI thread</code>). That means that operations that potentially take longer can lag the rendering of the UI and make the application look and feel slow.</p>
</div>
<div class="paragraph">
<p>To tackle issues with slowness where UI sharpness and high performance are critical, developers can use NativeScript&#8217;s solution to multithreading - worker threads. Workers are scripts executing on a background thread in an absolutely isolated context. Tasks that could take long to execute should be offloaded on to a worker thread.</p>
</div>
<div class="paragraph">
<p>Workers API in NativeScript is loosely based on the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">Dedicated Web Workers API</a> and the <a href="https://www.w3.org/TR/workers/">Web Workers Specification</a></p>
</div>
</div>
<div class="sect2">
<h3 id="workers-api"><a class="anchor" href="#workers-api"></a>Workers API</h3>
<div class="sect3">
<h4 id="worker-object-prototype"><a class="anchor" href="#worker-object-prototype"></a>Worker Object prototype</h4>
<div class="ulist">
<ul>
<li>
<p><code>new Worker(path)</code> - creates an instance of a Worker and spawns a new OS thread, where the script pointed to by the <code>path</code> parameter is executed.</p>
</li>
<li>
<p><code>postMessage(message)</code> - sends a JSON-serializable message to the associated script&#8217;s <code>onmessage</code> event handler.</p>
</li>
<li>
<p><code>terminate()</code> - terminates the execution of the worker thread on the next run loop tick.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Worker</strong> Object event handlers</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onmessage(message)</code> - handle incoming messages sent from the associated worker thread. The message object has the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>message.data</code> - the message&#8217;s content, as sent in the worker thread&#8217;s <code>postMessage</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>onerror(error)</code> - handle uncaught errors from the worker thread. The error object exposes the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>error.message</code> - the uncaught error, and a stacktrace, if applicable</p>
</li>
<li>
<p><code>error.filename</code> - the file where the uncaught error was thrown</p>
</li>
<li>
<p><code>error.lineno</code> - the line where the uncaught error was thrown</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="worker-global-scope"><a class="anchor" href="#worker-global-scope"></a>Worker Global Scope</h3>
<div class="ulist">
<ul>
<li>
<p><code>self</code> - returns a reference to the <code>WorkerGlobalScope</code> itself</p>
</li>
<li>
<p><code>postMessage(message)</code> - sends a JSON-serializable message to the Worker instance&#8217;s <code>onmessage</code> event handler on the main thread.</p>
</li>
<li>
<p><code>close()</code> - terminates the execution of the worker thread on the next run loop tick</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Worker</strong> Global Scope event handlers</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onmessage(message)</code> - handle incoming messages sent from the main thread. The message object exposes the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>message.data</code> - the message&#8217;s content, as sent in the main thread&#8217;s <code>postMessage</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>onerror(error)</code> - handle uncaught errors occurring during execution of functions inside the Worker Scope (worker thread). The <code>error</code> parameter contains the uncaught error. If the handler returns a true-like value, the message will not propagate to the Worker instance&#8217;s <code>onerror</code> handler on the main thread. After <code>onerror</code> is called the worker thread, execution is not terminated and the worker is still capable of sending/receiving messages.</p>
</li>
<li>
<p><code>onclose()</code> - handle any "clean-up" work; suitable for freeing up resources, closing streams and sockets.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="sample-usage"><a class="anchor" href="#sample-usage"></a>Sample Usage</h3>
<div class="imageblock unresolved">
<div class="content">
<img src="/assets/images/multithreading/Workers.png" alt="NativeScript Workers API">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
In order to use <code>console</code>'s methods, setTimeout/setInterval, or other functionality coming from the core-modules package, the <code>globals</code> module needs to be imported manually to bootstrap the infrastructure on the new worker thread.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>main-view-model.js</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">...

const worker = new Worker("./workers/image-processor");
worker.postMessage({ src: imageSource, mode: 'scale', options: options });

worker.onmessage = function(msg) {
  if (msg.data.success) {
    // Stop idle animation
    // Update Image View
    // Terminate worker or send another message

    worker.terminate();
  } else {
    // Stop idle animation
    // Display meaningful message
    // Terminate worker or send message with different parameters
  }
}

worker.onerror = function(err) {
  console.log(`An unhandled error occurred in worker: ${err.filename}, line: ${err.lineno} :`);
  console.log(err.message);
}

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>workers/image-processor.js</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">require('@nativescript/core/globals') // necessary to bootstrap ns modules on the new thread

global.onmessage = function (msg) {
  const request = msg.data
  const src = request.src
  const mode = request.mode || 'noop'
  const options = request.options

  const result = processImage(src, mode, options)

  const msg = result !== undefined ? { success: true, src: result } : {}

  global.postMessage(msg)
}

function processImage(src, mode, options) {
  console.log(options) // will throw an exception if `globals` hasn't been imported before this call

  // image processing logic

  // save image, retrieve location

  // return source to processed image
  return updatedImgSrc
}

// does not handle errors with an `onerror` handler
// errors will propagate directly to the main thread Worker instance

// to handle errors implement the global.onerror handler:
// global.onerror = function(err) {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="general-guidelines"><a class="anchor" href="#general-guidelines"></a>General Guidelines</h3>
<div class="paragraph">
<p>For optimal results when using the Workers API, follow these guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always make sure you close the worker threads, using the appropriate API (<code>terminate()</code> or <code>close()</code>), when the worker&#8217;s finished its job. If Worker instances become unreachable in the scope you are working in before you are able to terminate it, you will be able to close it only from inside the worker script itself by calling the <code>close()</code> function.</p>
</li>
<li>
<p>Workers are not a general solution for all performance-related problems. Starting a Worker has an overhead of its own, and may sometimes be slower than just processing a quick task. Optimize DB queries, or rethink complex application logic before resorting to workers.</p>
</li>
<li>
<p>Since worker threads have access to the entire native SDK, the NativeScript developer must take care of all the synchronization when calling APIs which are not guaranteed to be thread-safe from more than one thread.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="limitations"><a class="anchor" href="#limitations"></a>Limitations</h3>
<div class="paragraph">
<p>There are certain limitations to keep in mind when working with workers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No JavaScript memory sharing. This means that you can&#8217;t access a JavaScript value/object from both threads. You can only serialize the object, send it to the other thread and deserialize it there. This is what postMessage() function is responsible for. However, this is not the case with native objects. You can access a native object from more than one thread, without copying it, because the runtime will create a separate JavaScript wrapper object for each thread. Keep in mind that when you are using non-thread-safe native APIs and data you have to handle the synchronization part on your own. The runtime doesn&#8217;t perform any locking or synchronization logic on native data access and API calls.</p>
</li>
<li>
<p>Only JSON-serializable objects can be sent with postMessage() API.</p>
<div class="ulist">
<ul>
<li>
<p>You can&#8217;t send native objects. This means that you can&#8217;t send native objects with postMessage, because in most of the cases JSON serializing a JavaScript wrapper of a native object results in empty object literal - "{}". On the other side this message will be deserialized to a pure empty JavaScript object. Sending native object is something we want to support in the future, so stay tuned.</p>
</li>
<li>
<p>Also, be careful when sending circular objects because their recursive nodes will be stripped on the serialization step.</p>
</li>
</ul>
</div>
</li>
<li>
<p>No object transferring. If you are a web developer you may be familiar with the ArrayBuffer and MessagePort transferring support in browsers. Currently, in NativeScript there is no such concept as object transferring.</p>
</li>
<li>
<p>Currently, you can&#8217;t debug scripts running in the context of worker thread. It will be available in the future.</p>
</li>
<li>
<p>No nested workers support. We want to hear from the community if this is something we need to support.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="demo-projects"><a class="anchor" href="#demo-projects"></a>Demo projects</h3>
<div class="paragraph">
<p>The below-attached projects demonstrate, how we could use the multithreading functionality in non-Angular NativeScript project as well as NativeScript Angular one.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/NativeScript/worker-loader">NativeScript Angular Demo</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metadata-filtering"><a class="anchor" href="#metadata-filtering"></a>Metadata filtering</h2>
<div class="sectionbody">

</div>
</div>
<h1 id="metadata" class="sect0"><a class="anchor" href="#metadata"></a>Metadata</h1>
<div class="openblock partintro">
<div class="content">
To allow JavaScript code to call into native iOS or Android code both NativeScript runtimes need the so called <strong><em>metadata</em></strong>. It contains all the necessary information about each of the supported native classes, interfaces, protocols, structures, enumerations, functions, variables, etc. and is generated at build time by examining the native libraries from the iOS/Android operating systems' SDKs and any third-party libraries and frameworks that are used by the {N} application. More detailed descriptions about the iOS and Android metadata format and features can be found in these two articles:
</div>
</div>
<div class="sect1">
<h2 id="android-metadata"><a class="anchor" href="#android-metadata"></a>Android Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NativeScript Metadata is the mapping between the JavaScript and the Android world. Besides a full list with all the available classes and methods, the metadata contains the <a href="http://developer.android.com/training/articles/perf-jni.html">JNI</a> signature for each accessible Android method/field. It is pre-generated, in a binary format, and embedded in the application package (apk), storing the minimal required information thus providing small size and highly efficient read access. The generation process uses bytecode reading to parse all publicly available types in the Android libraries supplied to the NativeScript project. The generator works as part of the Android build process, meaning that no user interaction is required for it to work.</p>
</div>
<div class="imageblock unresolved">
<div class="content">
<img src="/assets/images/metadata_diagram.png" alt="Metadata">
</div>
</div>
<div class="sect2">
<h3 id="metadata-api-level"><a class="anchor" href="#metadata-api-level"></a>Metadata API Level</h3>
<div class="paragraph">
<p>Only Android public APIs (<strong>including those of any plugins added to the project</strong>) present in the metadata will be accessible in JavaScript/TypeScript. That means, if an application is built with metadata for API level 23 (Android Marshmallow 6.0&#8201;&#8212;&#8201;6.0.1), the application user might have problems when running the application on an older device, for example with API levels 17 through 19 (Android KitKat 4.4&#8201;&#8212;&#8201;4.4.4).</p>
</div>
<div class="paragraph">
<p>Metadata is built automatically for the application. The metadata API level, or simply put, what API level the metadata is built for, is determined by the <code>--compileSdk</code> flag passed to the build. By default the nativescript CLI automatically detects the highest Android API level installed on the developer&#8217;s machine and passes it to the build implicitly. This <code>--compileSdk</code> flag can be supplied explicitly when starting a build: <code>ns run android --compileSdk=1</code>.</p>
</div>
<div class="sect3">
<h4 id="metadata-limitations"><a class="anchor" href="#metadata-limitations"></a>Metadata Limitations</h4>
<div class="paragraph">
<p>Let&#8217;s look at the Android <a href="https://developer.android.com/reference/android/widget/TextView.html">TextView</a>.
In API level 21 a method called <code>getLetterSpacing</code> was added. What that means is, an application developer can use the <code>"</code>getLetterSpacing` method only on two conditions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The built metadata is &gt;= 21</p>
</li>
<li>
<p>The device that the application will be running on is &gt;= 21</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="possible-implications-when-working-with-android-apis"><a class="anchor" href="#possible-implications-when-working-with-android-apis"></a>Possible Implications When Working With Android APIs</h4>
<div class="sect4">
<h5 id="implication-a-building-against-lower-api-level"><a class="anchor" href="#implication-a-building-against-lower-api-level"></a>Implication A: Building against lower API level.</h5>
<div class="paragraph">
<p>If an application is built with --compileSdk flag pointing to a lower Android API level, for example 19, the generated metadata will also be for API level 19. In that case making calls to API in Levels 21 and up will not be possible, because the metadata comprises of meta information about API level &lt;= 19.</p>
</div>
<div class="paragraph">
<p>This problem is easily solved by not specifying a --compileSdk flag and using the default behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="implication-b-building-against-higher-api-level"><a class="anchor" href="#implication-b-building-against-higher-api-level"></a>Implication B: Building against higher API level.</h5>
<div class="paragraph">
<p>What happens when an application is built with higher API level(e.g. 23), but runs on a device with a lower API level(e.g. 20)?
First the metadata is built for API level 23. If the javascript code calls a method introduced after API level 20 the Android runtime will try to call this method because it will recognize it in the metadata, but when the actual native call is made on the lower level device, an exception will be trown because this method won&#8217;t be present on the device.</p>
</div>
<div class="paragraph">
<p>This problem is solved by detecting the API level at run-time and using the available API.</p>
</div>
<div class="paragraph">
<p>Detecting the API Level in JavaScript:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">if (android.os.Build.VERSION.SDK_INT &gt;= 21) {
  // your api level-specific code
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-apis"><a class="anchor" href="#accessing-apis"></a>Accessing APIs</h3>
<div class="paragraph">
<p>One of NativeScript&#8217;s strongest capabilities is the access to Android (also referred to as <strong>'Java/Kotlin'</strong> or <strong>'native'</strong>) APIs inside JavaScript/TypeScript. That&#8217;s possible thanks to build-time generated <a href="#metadata">Metadata</a> chunks which hold the information about the public classes from the Android SDK, Android support libraries, and any other Android libraries which may be imported into your Android NativeScript project.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
'Android classes' and 'Java/Kotlin classes' are used interchangeably throughout the article to refer to classes in the Java/Kotlin programming language.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>==== Access Android Packages</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <a href="https://developer.android.com/reference/packages.html">Android packages</a> are available in the JavaScript/TypeScript global context and are the entry point for accessing Android APIs. Think of them as of TypeScript/C# namespaces, or the way to access sets of classes. For example, the <code>android.view</code> package grants access to classes like <code>android.view.View</code> - the base of all view elements in Android.</p>
</div>
<div class="paragraph">
<p>In order to access a particular class in JavaScript/TypeScript the full package name leading up to the class name needs to be specified, or you may end up working with <code>undefined</code> variables.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://developer.android.com/reference/java/lang/package-summary.html">java.lang</a></p>
</li>
<li>
<p><a href="http://developer.android.com/reference/android/package-summary.html">android</a></p>
</li>
<li>
<p><a href="http://developer.android.com/reference/android/view/package-summary.html">android.view</a></p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above is accessed in JavaScript like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const javaLangPkg = java.lang
const androidPkg = android
const androidViewPkg = android.view

// access classes from inside the packages later on

const View = androidViewPkg.View
// or
const View = android.view.View

const Object = javaLangPkg.Object // === java.lang.Object;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To find out the package name of an Android class, refer to the <a href="https://developer.android.com/reference/packages.html">Android SDK Reference</a>, or to the supplied API Reference of a plugin, when importing 3rd-party Android components into your project.</p>
</div>
<div class="paragraph">
<p>For example, if you need to work with the Google API for Google Maps, after following the installation guide, you may need to access packages from the plugin like <code>com.google.android.gms.maps</code>, which you can find a reference for at <a href="https://developers.google.com/android/reference/com/google/android/gms/maps/package-summary">Google APIs for Android Reference</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
To have access and Intellisense for the native APIs with <strong>NativeScript + TypeScript</strong> or <strong>NativeScript + Angular</strong> projects, you have to add a dev dependency to <code>@nativescript/types</code>. More details about accessing native APIs with TypeScript can be found link:{% slug access-native-apis %}#intellisense-and-access-to-native-apis-via-typescript[here].</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
<strong>(Experimental)</strong> Alternatively, to get Intellisense for the native APIs based on the available Android Platform SDK and imported Android Support packages (added by default to your Android project), supply the <code>--androidTypings</code> flag with your <code>ns run | build android</code> command. The resulting <code>android.d.ts</code> file can then be used to provide auto-completion.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>warning Note
You cannot use APIs that are not present in the metadata. By default, if <code>--compileSdk</code> argument isn&#8217;t provided while building, metadata will be built against the latest Android <a href="https://developer.android.com/about/versions/nougat/index.html">Platform SDK</a> installed on the workstation. See <a href="#metadata-limitations">metadata limitations</a>.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">:</dt>
<dd>
<p>==== Access Android Classes</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Classes (<a href="https://docs.oracle.com/javase/tutorial/java/concepts/">See OOP</a>) are the schematics to producing building blocks (Objects) in Android, as such, they are used to represent almost everything you see, as well as what you don&#8217;t see, in an Android application - the Android layouts are objects built from classes, the buttons and text views also have class representations. Classes in Java and Kotlin have unique identifiers denoted by the full package name (see above), followed by the actual class name (usually capitalized - see above - 'View')</p>
</div>
<div class="paragraph">
<p>Accessing classes in Android you would normally add an <code>import</code> statement at the beginning of the Java/Kotlin file, to allow referring to the class only by its name. If the developer decides, they may be as expressive as possible by using the full class identifier too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package my.awesome.application;

import android.view.View;

public class ... {
  public static void staticMethod(context) {
    View newView = new View(context);
    // or
    android.view.View newView2 = new android.view.View(context);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accessing Android classes, in the JavaScript/TypeScript of a NativeScript application, is kept as close to the original Java syntax as the JavaScript language allows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">function arbitraryFunction(context) {
  // 'context' is a JavaScript wrapper (Proxy - see below) for the underlying android.content.Context Java instance
  const View = android.view.View

  const newView = new View(context)
  // or
  const newView2 = new android.view.View(context)

  // newView and newView2 will be JavaScript wrappers (Proxies - see below) for the created Java android.view.View objects
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="proxies"><a class="anchor" href="#proxies"></a>Proxies</h4>
<div class="paragraph">
<p>The JavaScript objects that lie behind the Android APIs are called <em>Proxies</em>. There are two types of proxies:</p>
</div>
</div>
<div class="sect3">
<h4 id="package-proxy"><a class="anchor" href="#package-proxy"></a>Package Proxy</h4>
<div class="paragraph">
<p>Provides access to the classes, interfaces, constants and enumerations within each package. See <code>java.lang</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="class-proxy"><a class="anchor" href="#class-proxy"></a>Class Proxy</h4>
<div class="paragraph">
<p>Represents a thin wrapper over a class or an interface and provides access to its methods and fields. From a JavaScript perspective this type of proxy may be considered as a constructor function. For example <code>android.view.View</code> is a class proxy.</p>
</div>
<div class="paragraph">
<p>The result of the constructor calls (<code>new ...()</code>) will create native <code>android.view.View</code> instances on the Android side and a special hollow Object on the JavaScript side. This special object knows how to invoke methods and access fields on the corresponding native instance. For example we may retrieve the path value of the above created <code>File</code> using the corresponding <code>File</code> class API like:</p>
</div>
</div>
<div class="sect3">
<h4 id="access-methods-fields-and-constants"><a class="anchor" href="#access-methods-fields-and-constants"></a>Access Methods, Fields and Constants</h4>
<div class="paragraph">
<p>Thanks to the 'proxying' system, Java/Kotlin methods and fields can be accessed through the JavaScript wrappers of the native instances. For example, you may retrieve the result of a method call to the Java instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const javaObj = new java.lang.Object()

// result is `int` in Java, marshalled to a JavaScript number
const javaObjHashCode = javaObj.hashCode()

// prints out the hashCode number
console.log(javaObjHashCode)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Public and private members, as well as static fields of an instance, or Java/Kotlin classes can also be accessed. The <a href="https://developer.android.com/reference/android/view/View.html">android.view.View</a> class will be used below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">// retrieve context
const context = ...;
const newView = new android.view.View(context);

// public member call to 'public void clearFocus()' as declared in Android
newView.clearFocus();

// public static field access to 'public static final SCALE_X' as declared in Android
let newViewScaleX = newView.SCALE_X;

// public static field access to `FOCUS_UP` - represents an integer as declared in the Android source
const focusUpDirection = android.view.View.FOCUS_UP;

// public member call to 'public View focusSearch(int direction)'
let foundView = newView.focusSearch(android.view.View.FOCUS_UP);

// static method call to 'public static int generateViewId()' - generates a random integer suitable for Android Views
const randomViewId = android.view.View.generateViewId();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extend-classes-and-interfaces"><a class="anchor" href="#extend-classes-and-interfaces"></a>Extend Classes and Interfaces</h4>
<div class="paragraph">
<p>For a comprehensive guide on extending classes and implementing interfaces through JavaScript/TypeScript check out <a href="/binding-generator/extend-class-interface">the dedicated article</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="full-fledged-example"><a class="anchor" href="#full-fledged-example"></a>Full-fledged Example</h4>
<div class="paragraph">
<p>Let&#8217;s take a sample Android code, and transcribe it to JavaScript/TypeScript.</p>
</div>
<div class="paragraph">
<p>The following code (courtesy of <a href="http://startandroid.ru/en/lessons/220-lesson-16-creating-layout-programmatically-layoutparams.html">startandroid.ru</a>) creates an Android layout, and adds a couple Button and TextView elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MainActivity extends Activity {
  /** Called when the activity is first created. */
  @Override
  public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    // creating LinearLayout
    LinearLayout linLayout = new LinearLayout(this);
    // specifying vertical orientation
    linLayout.setOrientation(LinearLayout.VERTICAL);
    // creating LayoutParams
    LayoutParams linLayoutParam = new LayoutParams(
      LayoutParams.MATCH_PARENT,
      LayoutParams.MATCH_PARENT
    );
    // set LinearLayout as a root element of the screen
    setContentView(linLayout, linLayoutParam);

    LayoutParams lpView = new LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    );

    TextView tv = new TextView(this);
    tv.setText("TextView");
    tv.setLayoutParams(lpView);
    linLayout.addView(tv);

    Button btn = new Button(this);
    btn.setText("Button");
    linLayout.addView(btn, lpView);


    LinearLayout.LayoutParams leftMarginParams = new LinearLayout.LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    );
    leftMarginParams.leftMargin = 50;

    Button btn1 = new Button(this);
    btn1.setText("Button1");
    linLayout.addView(btn1, leftMarginParams);


    LinearLayout.LayoutParams rightGravityParams = new LinearLayout.LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    );
    rightGravityParams.gravity = Gravity.RIGHT;

    Button btn2 = new Button(this);
    btn2.setText("Button2");
    linLayout.addView(btn2, rightGravityParams);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">class MainKotlinActivity: Activity() {
  override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    // creating LinearLayout
    val linLayout = LinearLayout(this)
    // specifying vertical orientation
    linLayout.orientation = LinearLayout.VERTICAL
    // creating LayoutParams
    val linLayoutParam = LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT)
    // set LinearLayout as a root element of the screen
    setContentView(linLayout, linLayoutParam)

    val lpView = LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    )

    val tv = TextView(this)
    tv.text = "TextView"
    tv.layoutParams = lpView
    linLayout.addView(tv)

    val btn = Button(this)
    btn.text = "Button"
    linLayout.addView(btn, lpView)


    val leftMarginParams = LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    )
    leftMarginParams.leftMargin = 50

    val btn1 = Button(this)
    btn1.text = "Button1"
    linLayout.addView(btn1, leftMarginParams)


    val rightGravityParams = LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    )
    rightGravityParams.gravity = Gravity.RIGHT

    val btn2 = Button(this)
    btn2.text = "Button2"
    linLayout.addView(btn2, rightGravityParams)
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const MainActivity = android.app.Activity.extend('my.application.name.MainActivity', {
  onCreate: function (savedInstanceState) {
    super.onCreate(savedInstance)

    // creating LinearLayout
    let linLayout = new android.widget.LinearLayout(this)
    // specifying vertical orientation
    linLayout.setOrientation(android.widget.LinearLayout.VERTICAL)
    // creating LayoutParams - accessing static class LayoutParams of LinearLayout
    let linLayoutParam = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.MATCH_PARENT,
      android.widget.LinearLayout.LayoutParams.MATCH_PARENT
    )
    // set LinearLayout as a root element of the screen
    this.setContentView(linLayout, linLayoutParam)

    let lpView = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT,
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT
    )

    let tv = new android.widget.TextView(this)
    tv.setText('TextView')
    tv.setLayoutParams(lpView)
    linLayout.addView(tv)

    let btn = new android.widget.Button(this)
    btn.setText('Button')
    linLayout.addView(btn, lpView)

    let leftMarginParams = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT,
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT
    )
    leftMarginParams.leftMargin = 50

    let btn1 = new android.widget.Button(this)
    btn1.setText('Button1')
    linLayout.addView(btn1, leftMarginParams)

    let rightGravityParams = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT,
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT
    )
    rightGravityParams.gravity = android.view.Gravity.RIGHT

    let btn2 = new android.widget.Button(this)
    btn2.setText('Button2')
    linLayout.addView(btn2, rightGravityParams)
  }
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">@JavaProxy("my.application.name.MainActivity");
class MainActivity extends android.app.Activity {
  constructor() {
    super();

    return global.__native(this);
  }

  onCreate(savedInstanceState) {
    super.onCreate(savedInstance);

    // creating LinearLayout
    let linLayout = new android.widget.LinearLayout(this);
    // specifying vertical orientation
    linLayout.setOrientation(android.widget.LinearLayout.VERTICAL);
    // creating LayoutParams - accessing static class LayoutParams of LinearLayout
    let linLayoutParam = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.MATCH_PARENT,
      android.widget.LinearLayout.LayoutParams.MATCH_PARENT
    );
    // set LinearLayout as a root element of the screen
    this.setContentView(linLayout, linLayoutParam);

    let lpView = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT,
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT
    );

    let tv = new android.widget.TextView(this);
    tv.setText("TextView");
    tv.setLayoutParams(lpView);
    linLayout.addView(tv);

    let btn = new android.widget.Button(this);
    btn.setText("Button");
    linLayout.addView(btn, lpView);


    let leftMarginParams = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT,
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT
    );
    leftMarginParams.leftMargin = 50;

    let btn1 = new android.widget.Button(this);
    btn1.setText("Button1");
    linLayout.addView(btn1, leftMarginParams);


    let rightGravityParams = new android.widget.LinearLayout.LayoutParams(
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT,
      android.widget.LinearLayout.LayoutParams.WRAP_CONTENT
    );
    rightGravityParams.gravity = android.view.Gravity.RIGHT;

    let btn2 = new android.widget.Button(this);
    btn2.setText("Button2");
    linLayout.addView(btn2, rightGravityParams);
  }
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The NativeScript code can further be shortened, and it starts to look a lot like Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const LinearLayout = android.widget.LinearLayout
const LayoutParams = android.widget.LinearLayout.LayoutParams
const TextView = android.widget.TextView
const Button = android.widget.Button
const Gravity = android.view.Gravity

const MainActivity = android.app.Activity.extend('my.application.name.MainActivity', {
  onCreate: function (savedInstanceState) {
    super.onCreate(savedInstance)

    // creating LinearLayout
    let linLayout = new LinearLayout(this)
    // specifying vertical orientation
    linLayout.setOrientation(LinearLayout.VERTICAL)
    // creating LayoutParams
    let linLayoutParam = new LayoutParams(
      LayoutParams.MATCH_PARENT,
      LayoutParams.MATCH_PARENT
    )
    // set LinearLayout as a root element of the screen
    setContentView(linLayout, linLayoutParam)

    let lpView = new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT)

    let tv = new TextView(this)
    tv.setText('TextView')
    tv.setLayoutParams(lpView)
    linLayout.addView(tv)

    let btn = new Button(this)
    btn.setText('Button')
    linLayout.addView(btn, lpView)

    let leftMarginParams = new LinearLayout.LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    )
    leftMarginParams.leftMargin = 50

    let btn1 = new Button(this)
    btn1.setText('Button1')
    linLayout.addView(btn1, leftMarginParams)

    let rightGravityParams = new LinearLayout.LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    )
    rightGravityParams.gravity = Gravity.RIGHT

    let btn2 = new Button(this)
    btn2.setText('Button2')
    linLayout.addView(btn2, rightGravityParams)
  }
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">const LinearLayout = android.widget.LinearLayout;
const LayoutParams = android.widget.LinearLayout.LayoutParams;
const TextView = android.widget.TextView;
const Button = android.widget.Button;
const Gravity = android.view.Gravity;

@JavaProxy("my.application.name.MainActivity");
class MainActivity extends android.app.Activity {
  constructor() {
    super();

    return global.__native(this);
  }

  onCreate: function (savedInstanceState) {
    super.onCreate(savedInstance);

    // creating LinearLayout
    let linLayout = new LinearLayout(this);
    // specifying vertical orientation
    linLayout.setOrientation(LinearLayout.VERTICAL);
    // creating LayoutParams
    let linLayoutParam = new LayoutParams(
      LayoutParams.MATCH_PARENT,
      LayoutParams.MATCH_PARENT
    );
    // set LinearLayout as a root element of the screen
    setContentView(linLayout, linLayoutParam);

    let lpView = new LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    );

    let tv = new TextView(this);
    tv.setText("TextView");
    tv.setLayoutParams(lpView);
    linLayout.addView(tv);

    let btn = new Button(this);
    btn.setText("Button");
    linLayout.addView(btn, lpView);


    let leftMarginParams = new LinearLayout.LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    );
    leftMarginParams.leftMargin = 50;

    let btn1 = new Button(this);
    btn1.setText("Button1");
    linLayout.addView(btn1, leftMarginParams);


    let rightGravityParams = new LinearLayout.LayoutParams(
      LayoutParams.WRAP_CONTENT,
      LayoutParams.WRAP_CONTENT
    );
    rightGravityParams.gravity = Gravity.RIGHT;

    let btn2 = new Button(this);
    btn2.setText("Button2");
    linLayout.addView(btn2, rightGravityParams);
  }
});</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ios-metadata"><a class="anchor" href="#ios-metadata"></a>iOS Metadata</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="metadata-filtering-2"><a class="anchor" href="#metadata-filtering-2"></a>Metadata Filtering</h3>
<div class="paragraph">
<p>By default NativeScript includes all supported entities in the metadata. This allows app and plugin authors to freely call any native API from JavaScript. While it is benefitial during development, in some cases having metadata for all the APIs is undesirable. There could be security implications involved (mentioning names of entities that shouldn&#8217;t be known in the metadata binary files for example); performance could be degraded at runtime (due to larger metabase which has to be consulted when an unknown entry is encountered or at startup); or app size could increase due to unnecessary metadata which is never used.</p>
</div>
<div class="paragraph">
<p>To give developers control over what to be included or not in the generated metadata there&#8217;s support for black and whitelisting symbols by their native name.</p>
</div>
</div>
<div class="sect2">
<h3 id="metadata-filtering-rules-in-plugins"><a class="anchor" href="#metadata-filtering-rules-in-plugins"></a>Metadata filtering rules in plugins</h3>
<div class="paragraph">
<p>Plugins can declare their list of APIs that are called from JavaScript using a file named <code>native-api-usage.json</code>, located in each of the platform directories (<code>platforms/android</code> or <code>platforms/ios</code>). Its format is similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "uses": ["java.util:List"]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="metadata-filtering-rules-in-apps"><a class="anchor" href="#metadata-filtering-rules-in-apps"></a>Metadata filtering rules in apps</h3>
<div class="paragraph">
<p>Applications have the final word of what filtering will be applied to metadata. They provide similar <code>native-api-usage.json</code> files, located in <code>App_Resources/Android</code> and <code>App_Resources/iOS</code>, having the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "whitelist-plugins-usages": true,
  "whitelist": ["java.util:Base64*"],
  "blacklist": ["java.util:Locale*"]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="rules-syntax"><a class="anchor" href="#rules-syntax"></a>Rules syntax</h3>
<div class="paragraph">
<p>Each list comprises of pattern entries with the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Entries are of the form <code>&lt;pattern1&gt;[:pattern2]</code></p>
</li>
<li>
<p>On Android, <strong><em>pattern1</em></strong> is matched against Java package names, while the optional <strong><em>pattern2</em></strong>&#8201;&#8212;&#8201;against classes, interfaces, enums.</p>
</li>
<li>
<p>On iOS, <strong><em>pattern1</em></strong> is matched against Clang module/submodule names, while the optional <strong><em>pattern2</em></strong>&#8201;&#8212;&#8201;against structs, global functions, enums, Objective-C interfaces, protocols, categories, constants, etc.</p>
</li>
<li>
<p>Patterns support wildcards (<strong>"</strong>"* - any number of characters and <strong>"?"</strong> - any single character).</p>
</li>
<li>
<p>An unspecified or empty pattern is equivalent to being set to <strong>"</strong>"* (matching everything)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="rules-semantics"><a class="anchor" href="#rules-semantics"></a>Rules semantics</h3>
<div class="paragraph">
<p>After analyzing the filtering rules for a platform, {N} CLI builds final whitelist and blacklist files and outputs them in the native project to be used by the corresponding metadata generator. The blacklist is always equal to the one specified by the app. While the whitelist depends on the <code>whitelist-plugins-usages</code> flag:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If it is <code>true</code>, the final whitelist is a concatenation of all plugins' usage lists with the app&#8217;s whitelist</p>
</li>
<li>
<p>Otherwise, it is equal to the app&#8217;s whitelist</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two lists unambiguously determine how filtering is performed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the whitelist is empty, then everything is considered whitelisted by default</p>
</li>
<li>
<p>If it contains at least one rule, only entities matching a rule are considered whitelisted</p>
</li>
<li>
<p>All entities which are not whitelisted or match a rule in the blacklist are stripped from metadata</p>
</li>
<li>
<p>All other entities are included in the metadata</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>Examples</h3>
<div class="paragraph">
<p>Sample filtering specifications can be found in <code>@nativescript/core</code> plugin&#8217;s repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/NativeScript/NativeScript/blob/master/packages/core/platforms/android/native-api-usage.json">Android API usage list</a></p>
</li>
<li>
<p><a href="https://github.com/NativeScript/NativeScript/blob/master/packages/core/platforms/ios/native-api-usage.json">iOS API usage list</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>Troubleshooting</h3>
<div class="paragraph">
<p>Missing metadata entities could result in bugs at runtime. For example, if a native class has been accidentally filtered out, its constructor function will be <code>undefined</code> and this will lead to an exception when its attempted to be called. Figuring out what is the reason for something being <code>undefined</code> could be quite difficult because the reasons can vary. To check whether metadata filtering is to blame or not you should examine metadata generator&#8217;s verbose logs after a successful build:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On iOS they are located in <code>platforms/ios/build/&lt;configuration&gt;-&lt;platform&gt;/metadata-generation-stderr-&lt;arch&gt;.txt</code> (e.g. <code>platforms/ios/build/Debug-iphonesimulator/metadata-generation-stderr-x86_64.txt</code>);</p>
</li>
<li>
<p>On Android they are located in <code>platforms/android/build-tools/buildMetadata.log</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each global symbol that is discovered by the generator, there should be a line providing information whether it was included in metadata or not, and which rules or what exception caused this. Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>verbose: Blacklisted kCFBuddhistCalendar from CoreFoundation.CFLocale (disabled by 'CoreFoundation*:*')</code> - when there are no whitelist rules a blacklisted symbol will show only the rule which disabled it</p>
</li>
<li>
<p><code>verbose: Blacklisted NSString from Foundation.NSString</code> - when there is at least one whitelist rule, some blacklisted symbols will not specify a rule. This means that the symbol didn&#8217;t match any of the whitelist rules.</p>
</li>
<li>
<p><code>verbose: Blacklisted PHImageContentModeDefault from Photos.PhotosTypes (enabled by 'Photos.PhotosTypes:*', disabled by 'Photos.PhotosTypes:PHImageContentMode*')</code>, <code>verbose: Blacklisted String from java.lang (enabled by java.lang:*, disabled by java.lang:String)</code> - a blacklisted entry which matches both a whitelist rule and a blacklist rule will specify both.</p>
</li>
<li>
<p><code>verbose: Included NSObject from ObjectiveC.NSObject</code> - when there are no whitelist rules an included symbol won&#8217;t specify a rule which caused it to be included</p>
</li>
<li>
<p><code>verbose: Included PHCollectionListType from Photos.PhotosTypes (enabled by 'Photos.PhotosTypes:*')</code>, <code>verbose: Included StrictMath from java.lang (enabled by java.lang:*)</code> - when a symbol is included because it matched a rule from the whitelist (and didn&#8217;t match any from the blacklist) it will print that rule</p>
</li>
<li>
<p><code>verbose: Exception [Name: 'vfwprintf', JsName: 'vfwprintf', Module: 'Darwin.C.wchar', File: '/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator13.2.sdk/usr/include/wchar.h'] : Can't create type dependency. --&gt; [Type Decayed] : Can't create type dependency. --&gt; [Type Typedef] : VaList type is not supported.</code> - if a symbol is not included because it isn&#8217;t supported for some reason it will be stated in the logged exception. In this case the symbol cannot be used from JavaScript because {N} doesn&#8217;t support calling functions with variable argument lists.</p>
</li>
<li>
<p><code>verbose: Exception [Name: 'GLKVector3Make', JsName: 'GLKVector3Make', Module: 'GLKit.GLKVector3', File: '/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator13.2.sdk/System/Library/Frameworks/GLKit.framework/Headers/GLKVector3.h'] : Can't create type dependency. --&gt; [Type Typedef] : Can't create type dependency. --&gt; [Type Elaborated] : Can't create type dependency. --&gt; [Type Record] : The record is an union.</code> - Another example of an unsupported symbol, this time the reason is that <code>union</code>s are unsupported</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="code-sharing"><a class="anchor" href="#code-sharing"></a>Code Sharing</h4>
<div class="ulist">
<ul>
<li>
<p><a href="#code-sharing/index.adoc" class="xref unresolved">Code Sharing</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../native-api-access/access-and-use.html">Accessing Native Platform APIs</a></span>
  <span class="next"><a href="#distribution/releasing.adoc">distribution/releasing.adoc</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <div class="footerdiv">
    <p>© 2022 OpenJS Foundation</p>
    <div class="community_icons">
        <a href="https://nativescript.org/discord" title="Discord" target="_blank" class="footer_icon icon-discord"><p>Discord</p></a>
        <a href="https://twitter.com/NativeScript" title="Twitter" target="_blank" class="footer_icon icon-discourse"><p>Twitter</p></a>
        <a href="https://github.com/NativeScript/NativeScript" title="GitHub" target="_blank" class="footer_icon icon-github"><p>GitHub</p></a>
  <!--    </div> -->
    </div>
  </div>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script async src="../_/js/vendor/tabs-block-behaviour.js"></script>
<script async src="../_/js/vendor/swagger-ui.js"></script>
<script async src="../_/js/vendor/component-versions.js"></script>
<script src="../_/js/vendor/custom.js"></script>
  </body>
</html>
